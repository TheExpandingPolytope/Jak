!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(t,n,r){var a;a=function(){function t(){var e,t,u=document.createElement("canvas"),s="t",c=1,f=2.2,l=null;return u.__defineGetter__("exposure",function(){return c}),u.__defineSetter__("exposure",function(n){c=n,l&&(i(l,c,f,t.data),e.putImageData(t,0,0))}),u.__defineGetter__("gamma",function(){return f}),u.__defineSetter__("gamma",function(n){f=n,l&&(i(l,c,f,t.data),e.putImageData(t,0,0))}),u.__defineGetter__("dataFloat",function(){return o(l)}),u.__defineGetter__("dataRGBE",function(){return l}),u.toHDRBlob=function(e,t,r){function a(e,t,n){var r=e.createShader(n);return e.shaderSource(r,t),e.compileShader(r),r}var i=t&&t.match(/rgb9_e5/i)?new Uint8Array(n(o(l)).buffer):new Uint8Array(l.buffer),u=this.width,s=this.height;if(u*s*4<i.byteLength)return console.error("not big enough.");var c=document.createElement("canvas");c.width=u,c.height=s;var f=c.getContext("webgl",{antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),m=f.createTexture();f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,m),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!0),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,u,s,0,f.RGBA,f.UNSIGNED_BYTE,new Uint8Array(i.buffer));var h=function(e,t,n){var r,o,i=e.createProgram();return e.attachShader(i,r=a(e,t,e.VERTEX_SHADER)),e.attachShader(i,o=a(e,n,e.FRAGMENT_SHADER)),e.linkProgram(i),e.deleteShader(r),e.deleteShader(o),i}(f,"precision highp float;\nattribute vec3 position;\nvarying vec2 tex;\nvoid main() { tex = position.xy/2.0+0.5; gl_Position = vec4(position, 1.0); }","precision highp float;\nprecision highp sampler2D;\nuniform sampler2D tx;\nvarying vec2 tex;\nvoid main() { gl_FragColor = texture2D(tx,tex); }"),d=f.getUniformLocation(h,"tx"),_=new Float32Array([-1,-1,0,1,-1,0,1,1,0,1,1,0,-1,1,0,-1,-1,0]),E=f.createBuffer();return f.enableVertexAttribArray(0),f.bindBuffer(f.ARRAY_BUFFER,E),f.bufferData(f.ARRAY_BUFFER,_,f.STATIC_DRAW),f.vertexAttribPointer(0,3,f.FLOAT,!1,0,0),f.useProgram(h),f.uniform1i(d,0),f.drawArrays(f.TRIANGLES,0,6),f.deleteTexture(m),f.deleteProgram(h),e?c.toBlob(e):void 0},u.__defineGetter__("src",function(){return s}),u.__defineSetter__("src",function(n){if(s=n,e&&e.clearRect(0,0,this.width,this.height),n.match(/\.hdr$/i))m=n,h=function(n,r,a){l=n,this.width=this.style.width=r,this.height=this.style.height=a,e=this.getContext("2d"),t=e.getImageData(0,0,r,a),i(n,c,f,t.data),e.putImageData(t,0,0),this.onload&&this.onload()}.bind(u),(d=function(e,t){for(var n in t)e[n]=t[n];return e}(new XMLHttpRequest,{responseType:"arraybuffer"})).onerror=h.bind(d,!1),d.onload=function(){if(this.status>=400)return this.onerror();for(var e,t="",n=0,r=new Uint8Array(this.response);!t.match(/\n\n[^\n]+\n/g);)t+=String.fromCharCode(r[n++]);if("32-bit_rle_rgbe"!=(e=t.match(/FORMAT=(.*)$/m)[1]))return console.warn("unknown format : "+e),this.onerror();for(var a=t.split(/\n/).reverse()[1].split(" "),o=1*a[3],i=1*a[1],u=new Uint8Array(o*i*4),s=0,c=0;c<i;c++){var f=r.slice(n,n+=4),l=[];if(2!=f[0]||2!=f[1]||128&f[2])return console.warn("HDR parse error .."),this.onerror();if((f[2]<<8)+f[3]!=o)return console.warn("HDR line mismatch .."),this.onerror();for(var m=0;m<4;m++)for(var d,_,E=m*o,v=(m+1)*o;E<v;)if((d=r.slice(n,n+=2))[0]>128)for(_=d[0]-128;_-- >0;)l[E++]=d[1];else for(_=d[0]-1,l[E++]=d[1];_-- >0;)l[E++]=r[n++];for(m=0;m<o;m++)u[s++]=l[m],u[s++]=l[m+o],u[s++]=l[m+2*o],u[s++]=l[m+3*o]}h&&h(u,o,i)},d.open("GET",m,!0),d.send(null);else if(n.match(/\.rgb9_e5\.png$/i)){(o=new Image).src=n,o.onload=function(){var n=document.createElement("canvas"),u=this.width=this.style.width=n.width=o.width,s=this.height=this.style.height=n.height=o.height,m=n.getContext("webgl"),h=m.createTexture();m.bindTexture(m.TEXTURE_2D,h),m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,o),fb=m.createFramebuffer(),m.bindFramebuffer(m.FRAMEBUFFER,fb),m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,h,0);var d=new Uint8Array(u*s*4);m.readPixels(0,0,u,s,m.RGBA,m.UNSIGNED_BYTE,d),m.deleteTexture(h),m.deleteFramebuffer(fb),this.dataRAW=new Uint32Array(d.buffer),l=a(r(this.dataRAW)),e=this.getContext("2d"),t=e.getImageData(0,0,u,s),i(l,c,f,t.data),e.putImageData(t,0,0),this.onload&&this.onload()}.bind(u)}else if(n.match(/\.hdr\.png$|\.rgbe\.png/i)){var o;(o=new Image).src=n,o.onload=function(){var n=document.createElement("canvas"),r=this.width=this.style.width=n.width=o.width,a=this.height=this.style.height=n.height=o.height,u=n.getContext("webgl"),s=u.createTexture();u.bindTexture(u.TEXTURE_2D,s),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,o),fb=u.createFramebuffer(),u.bindFramebuffer(u.FRAMEBUFFER,fb),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,s,0);var m=new Uint8Array(r*a*4);u.readPixels(0,0,r,a,u.RGBA,u.UNSIGNED_BYTE,m),u.deleteTexture(s),u.deleteFramebuffer(fb),l=m,e=this.getContext("2d"),t=e.getImageData(0,0,r,a),i(l,c,f,t.data),e.putImageData(t,0,0),this.onload&&this.onload()}.bind(u)}var m,h,d}),u}function n(e,t){for(var n,r,a,o,i,u,s=e.byteLength/12|0,c=(t=t||new Uint32Array(s),0);c<s;c++)n=Math.min(32768,e[3*c]),r=Math.min(32768,e[3*c+1]),a=Math.min(32768,e[3*c+2]),o=Math.max(Math.max(n,r),a),i=Math.max(-16,Math.floor(Math.log2(o)))+16,u=Math.pow(2,i-24),511==Math.floor(o/u+.5)&&(u*=2,i+=1),t[c]=(Math.floor(n/u+.5)<<23)+(Math.floor(r/u+.5)<<14)+(Math.floor(a/u+.5)<<5)+(0|i);return t}function r(e,t){for(var n,r,a=e.byteLength>>2,o=(t=t||new Float32Array(3*a),0);o<a;o++)n=e[o],r=Math.pow(2,(31&n)-24),t[3*o]=(n>>>23)*r,t[3*o+1]=(n>>>14&511)*r,t[3*o+2]=(n>>>5&511)*r;return t}function a(t,n){for(var r,a,o,i,u,s=t.byteLength/12|0,c=(n=n||new Uint8Array(4*s),0);c<s;c++)r=t[3*c],a=t[3*c+1],o=t[3*c+2],i=Math.max(Math.max(r,a),o),e=Math.ceil(Math.log2(i)),u=Math.pow(2,e-8),n[4*c]=r/u|0,n[4*c+1]=a/u|0,n[4*c+2]=o/u|0,n[4*c+3]=e+128;return n}function o(e,t){for(var n,r=e.byteLength>>2,a=(t=t||new Float32Array(3*r),0);a<r;a++)n=Math.pow(2,e[4*a+3]-136),t[3*a]=e[4*a]*n,t[3*a+1]=e[4*a+1]*n,t[3*a+2]=e[4*a+2]*n;return t}function i(e,t,n,r){t=Math.pow(2,void 0===t?1:t)/2,void 0===n&&(n=2.2);for(var a,o=1/n,i=e.byteLength>>2,u=(r=r||new Uint8ClampedArray(4*i),0);u<i;u++)a=t*Math.pow(2,e[4*u+3]-136),r[4*u]=255*Math.pow(e[4*u]*a,o),r[4*u+1]=255*Math.pow(e[4*u+1]*a,o),r[4*u+2]=255*Math.pow(e[4*u+2]*a,o),r[4*u+3]=255;return r}return t.floatToRgbe=a,t.rgbeToFloat=o,t.floatToRgb9_e5=n,t.rgb9_e5ToFloat=r,t.rgbeToLDR=i,t.floatToLDR=function(e,t,n,r){t=Math.pow(2,void 0===t?1:t)/2,void 0===n&&(n=2.2);for(var a=1/n,o=e.byteLength/12|0,i=(r=r||new Uint8ClampedArray(4*o),0);i<o;i++)r[4*i]=255*Math.pow(e[3*i]*t,a),r[4*i+1]=255*Math.pow(e[3*i+1]*t,a),r[4*i+2]=255*Math.pow(e[3*i+2]*t,a),r[4*i+3]=255;return r},t},t.exports?t.exports=a():r(1)("HDRImage",a)},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"create",function(){return l}),n.d(r,"clone",function(){return m}),n.d(r,"copy",function(){return h}),n.d(r,"fromValues",function(){return d}),n.d(r,"set",function(){return _}),n.d(r,"identity",function(){return E}),n.d(r,"transpose",function(){return v}),n.d(r,"invert",function(){return p}),n.d(r,"adjoint",function(){return T}),n.d(r,"determinant",function(){return g}),n.d(r,"multiply",function(){return M}),n.d(r,"translate",function(){return R}),n.d(r,"scale",function(){return x}),n.d(r,"rotate",function(){return b}),n.d(r,"rotateX",function(){return A}),n.d(r,"rotateY",function(){return U}),n.d(r,"rotateZ",function(){return P}),n.d(r,"fromTranslation",function(){return S}),n.d(r,"fromScaling",function(){return y}),n.d(r,"fromRotation",function(){return F}),n.d(r,"fromXRotation",function(){return L}),n.d(r,"fromYRotation",function(){return I}),n.d(r,"fromZRotation",function(){return w}),n.d(r,"fromRotationTranslation",function(){return N}),n.d(r,"fromQuat2",function(){return X}),n.d(r,"getTranslation",function(){return D}),n.d(r,"getScaling",function(){return B}),n.d(r,"getRotation",function(){return C}),n.d(r,"fromRotationTranslationScale",function(){return V}),n.d(r,"fromRotationTranslationScaleOrigin",function(){return O}),n.d(r,"fromQuat",function(){return G}),n.d(r,"frustum",function(){return H}),n.d(r,"perspective",function(){return k}),n.d(r,"perspectiveFromFieldOfView",function(){return z}),n.d(r,"ortho",function(){return q}),n.d(r,"lookAt",function(){return Y}),n.d(r,"targetTo",function(){return W}),n.d(r,"str",function(){return j}),n.d(r,"frob",function(){return K}),n.d(r,"add",function(){return Z}),n.d(r,"subtract",function(){return Q}),n.d(r,"multiplyScalar",function(){return $}),n.d(r,"multiplyScalarAndAdd",function(){return J}),n.d(r,"exactEquals",function(){return ee}),n.d(r,"equals",function(){return te}),n.d(r,"mul",function(){return ne}),n.d(r,"sub",function(){return re});var a={};n.r(a),n.d(a,"create",function(){return ae}),n.d(a,"clone",function(){return oe}),n.d(a,"length",function(){return ie}),n.d(a,"fromValues",function(){return ue}),n.d(a,"copy",function(){return se}),n.d(a,"set",function(){return ce}),n.d(a,"add",function(){return fe}),n.d(a,"subtract",function(){return le}),n.d(a,"multiply",function(){return me}),n.d(a,"divide",function(){return he}),n.d(a,"ceil",function(){return de}),n.d(a,"floor",function(){return _e}),n.d(a,"min",function(){return Ee}),n.d(a,"max",function(){return ve}),n.d(a,"round",function(){return pe}),n.d(a,"scale",function(){return Te}),n.d(a,"scaleAndAdd",function(){return ge}),n.d(a,"distance",function(){return Me}),n.d(a,"squaredDistance",function(){return Re}),n.d(a,"squaredLength",function(){return xe}),n.d(a,"negate",function(){return be}),n.d(a,"inverse",function(){return Ae}),n.d(a,"normalize",function(){return Ue}),n.d(a,"dot",function(){return Pe}),n.d(a,"cross",function(){return Se}),n.d(a,"lerp",function(){return ye}),n.d(a,"hermite",function(){return Fe}),n.d(a,"bezier",function(){return Le}),n.d(a,"random",function(){return Ie}),n.d(a,"transformMat4",function(){return we}),n.d(a,"transformMat3",function(){return Ne}),n.d(a,"transformQuat",function(){return Xe}),n.d(a,"rotateX",function(){return De}),n.d(a,"rotateY",function(){return Be}),n.d(a,"rotateZ",function(){return Ce}),n.d(a,"angle",function(){return Ve}),n.d(a,"zero",function(){return Oe}),n.d(a,"str",function(){return Ge}),n.d(a,"exactEquals",function(){return He}),n.d(a,"equals",function(){return ke}),n.d(a,"sub",function(){return ze}),n.d(a,"mul",function(){return qe}),n.d(a,"div",function(){return Ye}),n.d(a,"dist",function(){return We}),n.d(a,"sqrDist",function(){return je}),n.d(a,"len",function(){return Ke}),n.d(a,"sqrLen",function(){return Ze}),n.d(a,"forEach",function(){return Qe});var o={};n.r(o),n.d(o,"create",function(){return et}),n.d(o,"identity",function(){return tt}),n.d(o,"setAxisAngle",function(){return nt}),n.d(o,"getAxisAngle",function(){return rt}),n.d(o,"multiply",function(){return at}),n.d(o,"rotateX",function(){return ot}),n.d(o,"rotateY",function(){return it}),n.d(o,"rotateZ",function(){return ut}),n.d(o,"calculateW",function(){return st}),n.d(o,"slerp",function(){return ct}),n.d(o,"random",function(){return ft}),n.d(o,"invert",function(){return lt}),n.d(o,"conjugate",function(){return mt}),n.d(o,"fromMat3",function(){return ht}),n.d(o,"fromEuler",function(){return dt}),n.d(o,"str",function(){return _t}),n.d(o,"clone",function(){return Et}),n.d(o,"fromValues",function(){return vt}),n.d(o,"copy",function(){return pt}),n.d(o,"set",function(){return Tt}),n.d(o,"add",function(){return gt}),n.d(o,"mul",function(){return Mt}),n.d(o,"scale",function(){return Rt}),n.d(o,"dot",function(){return xt}),n.d(o,"lerp",function(){return bt}),n.d(o,"length",function(){return At}),n.d(o,"len",function(){return Ut}),n.d(o,"squaredLength",function(){return Pt}),n.d(o,"sqrLen",function(){return St}),n.d(o,"normalize",function(){return yt}),n.d(o,"exactEquals",function(){return Ft}),n.d(o,"equals",function(){return Lt}),n.d(o,"rotationTo",function(){return It}),n.d(o,"sqlerp",function(){return wt}),n.d(o,"setAxes",function(){return Nt});const i=1e-6;let u="undefined"!=typeof Float32Array?Float32Array:Array;const s=Math.random;const c=Math.PI/180;function f(e){return e*c}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function l(){let e=new u(16);return u!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function m(e){let t=new u(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function h(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function d(e,t,n,r,a,o,i,s,c,f,l,m,h,d,_,E){let v=new u(16);return v[0]=e,v[1]=t,v[2]=n,v[3]=r,v[4]=a,v[5]=o,v[6]=i,v[7]=s,v[8]=c,v[9]=f,v[10]=l,v[11]=m,v[12]=h,v[13]=d,v[14]=_,v[15]=E,v}function _(e,t,n,r,a,o,i,u,s,c,f,l,m,h,d,_,E){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=o,e[5]=i,e[6]=u,e[7]=s,e[8]=c,e[9]=f,e[10]=l,e[11]=m,e[12]=h,e[13]=d,e[14]=_,e[15]=E,e}function E(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v(e,t){if(e===t){let n=t[1],r=t[2],a=t[3],o=t[6],i=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=a,e[13]=i,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function p(e,t){let n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],u=t[5],s=t[6],c=t[7],f=t[8],l=t[9],m=t[10],h=t[11],d=t[12],_=t[13],E=t[14],v=t[15],p=n*u-r*i,T=n*s-a*i,g=n*c-o*i,M=r*s-a*u,R=r*c-o*u,x=a*c-o*s,b=f*_-l*d,A=f*E-m*d,U=f*v-h*d,P=l*E-m*_,S=l*v-h*_,y=m*v-h*E,F=p*y-T*S+g*P+M*U-R*A+x*b;return F?(F=1/F,e[0]=(u*y-s*S+c*P)*F,e[1]=(a*S-r*y-o*P)*F,e[2]=(_*x-E*R+v*M)*F,e[3]=(m*R-l*x-h*M)*F,e[4]=(s*U-i*y-c*A)*F,e[5]=(n*y-a*U+o*A)*F,e[6]=(E*g-d*x-v*T)*F,e[7]=(f*x-m*g+h*T)*F,e[8]=(i*S-u*U+c*b)*F,e[9]=(r*U-n*S-o*b)*F,e[10]=(d*R-_*g+v*p)*F,e[11]=(l*g-f*R-h*p)*F,e[12]=(u*A-i*P-s*b)*F,e[13]=(n*P-r*A+a*b)*F,e[14]=(_*T-d*M-E*p)*F,e[15]=(f*M-l*T+m*p)*F,e):null}function T(e,t){let n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],u=t[5],s=t[6],c=t[7],f=t[8],l=t[9],m=t[10],h=t[11],d=t[12],_=t[13],E=t[14],v=t[15];return e[0]=u*(m*v-h*E)-l*(s*v-c*E)+_*(s*h-c*m),e[1]=-(r*(m*v-h*E)-l*(a*v-o*E)+_*(a*h-o*m)),e[2]=r*(s*v-c*E)-u*(a*v-o*E)+_*(a*c-o*s),e[3]=-(r*(s*h-c*m)-u*(a*h-o*m)+l*(a*c-o*s)),e[4]=-(i*(m*v-h*E)-f*(s*v-c*E)+d*(s*h-c*m)),e[5]=n*(m*v-h*E)-f*(a*v-o*E)+d*(a*h-o*m),e[6]=-(n*(s*v-c*E)-i*(a*v-o*E)+d*(a*c-o*s)),e[7]=n*(s*h-c*m)-i*(a*h-o*m)+f*(a*c-o*s),e[8]=i*(l*v-h*_)-f*(u*v-c*_)+d*(u*h-c*l),e[9]=-(n*(l*v-h*_)-f*(r*v-o*_)+d*(r*h-o*l)),e[10]=n*(u*v-c*_)-i*(r*v-o*_)+d*(r*c-o*u),e[11]=-(n*(u*h-c*l)-i*(r*h-o*l)+f*(r*c-o*u)),e[12]=-(i*(l*E-m*_)-f*(u*E-s*_)+d*(u*m-s*l)),e[13]=n*(l*E-m*_)-f*(r*E-a*_)+d*(r*m-a*l),e[14]=-(n*(u*E-s*_)-i*(r*E-a*_)+d*(r*s-a*u)),e[15]=n*(u*m-s*l)-i*(r*m-a*l)+f*(r*s-a*u),e}function g(e){let t=e[0],n=e[1],r=e[2],a=e[3],o=e[4],i=e[5],u=e[6],s=e[7],c=e[8],f=e[9],l=e[10],m=e[11],h=e[12],d=e[13],_=e[14],E=e[15];return(t*i-n*o)*(l*E-m*_)-(t*u-r*o)*(f*E-m*d)+(t*s-a*o)*(f*_-l*d)+(n*u-r*i)*(c*E-m*h)-(n*s-a*i)*(c*_-l*h)+(r*s-a*u)*(c*d-f*h)}function M(e,t,n){let r=t[0],a=t[1],o=t[2],i=t[3],u=t[4],s=t[5],c=t[6],f=t[7],l=t[8],m=t[9],h=t[10],d=t[11],_=t[12],E=t[13],v=t[14],p=t[15],T=n[0],g=n[1],M=n[2],R=n[3];return e[0]=T*r+g*u+M*l+R*_,e[1]=T*a+g*s+M*m+R*E,e[2]=T*o+g*c+M*h+R*v,e[3]=T*i+g*f+M*d+R*p,T=n[4],g=n[5],M=n[6],R=n[7],e[4]=T*r+g*u+M*l+R*_,e[5]=T*a+g*s+M*m+R*E,e[6]=T*o+g*c+M*h+R*v,e[7]=T*i+g*f+M*d+R*p,T=n[8],g=n[9],M=n[10],R=n[11],e[8]=T*r+g*u+M*l+R*_,e[9]=T*a+g*s+M*m+R*E,e[10]=T*o+g*c+M*h+R*v,e[11]=T*i+g*f+M*d+R*p,T=n[12],g=n[13],M=n[14],R=n[15],e[12]=T*r+g*u+M*l+R*_,e[13]=T*a+g*s+M*m+R*E,e[14]=T*o+g*c+M*h+R*v,e[15]=T*i+g*f+M*d+R*p,e}function R(e,t,n){let r,a,o,i,u,s,c,f,l,m,h,d,_=n[0],E=n[1],v=n[2];return t===e?(e[12]=t[0]*_+t[4]*E+t[8]*v+t[12],e[13]=t[1]*_+t[5]*E+t[9]*v+t[13],e[14]=t[2]*_+t[6]*E+t[10]*v+t[14],e[15]=t[3]*_+t[7]*E+t[11]*v+t[15]):(r=t[0],a=t[1],o=t[2],i=t[3],u=t[4],s=t[5],c=t[6],f=t[7],l=t[8],m=t[9],h=t[10],d=t[11],e[0]=r,e[1]=a,e[2]=o,e[3]=i,e[4]=u,e[5]=s,e[6]=c,e[7]=f,e[8]=l,e[9]=m,e[10]=h,e[11]=d,e[12]=r*_+u*E+l*v+t[12],e[13]=a*_+s*E+m*v+t[13],e[14]=o*_+c*E+h*v+t[14],e[15]=i*_+f*E+d*v+t[15]),e}function x(e,t,n){let r=n[0],a=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function b(e,t,n,r){let a,o,u,s,c,f,l,m,h,d,_,E,v,p,T,g,M,R,x,b,A,U,P,S,y=r[0],F=r[1],L=r[2],I=Math.hypot(y,F,L);return I<i?null:(y*=I=1/I,F*=I,L*=I,a=Math.sin(n),u=1-(o=Math.cos(n)),s=t[0],c=t[1],f=t[2],l=t[3],m=t[4],h=t[5],d=t[6],_=t[7],E=t[8],v=t[9],p=t[10],T=t[11],g=y*y*u+o,M=F*y*u+L*a,R=L*y*u-F*a,x=y*F*u-L*a,b=F*F*u+o,A=L*F*u+y*a,U=y*L*u+F*a,P=F*L*u-y*a,S=L*L*u+o,e[0]=s*g+m*M+E*R,e[1]=c*g+h*M+v*R,e[2]=f*g+d*M+p*R,e[3]=l*g+_*M+T*R,e[4]=s*x+m*b+E*A,e[5]=c*x+h*b+v*A,e[6]=f*x+d*b+p*A,e[7]=l*x+_*b+T*A,e[8]=s*U+m*P+E*S,e[9]=c*U+h*P+v*S,e[10]=f*U+d*P+p*S,e[11]=l*U+_*P+T*S,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function A(e,t,n){let r=Math.sin(n),a=Math.cos(n),o=t[4],i=t[5],u=t[6],s=t[7],c=t[8],f=t[9],l=t[10],m=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*a+c*r,e[5]=i*a+f*r,e[6]=u*a+l*r,e[7]=s*a+m*r,e[8]=c*a-o*r,e[9]=f*a-i*r,e[10]=l*a-u*r,e[11]=m*a-s*r,e}function U(e,t,n){let r=Math.sin(n),a=Math.cos(n),o=t[0],i=t[1],u=t[2],s=t[3],c=t[8],f=t[9],l=t[10],m=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a-c*r,e[1]=i*a-f*r,e[2]=u*a-l*r,e[3]=s*a-m*r,e[8]=o*r+c*a,e[9]=i*r+f*a,e[10]=u*r+l*a,e[11]=s*r+m*a,e}function P(e,t,n){let r=Math.sin(n),a=Math.cos(n),o=t[0],i=t[1],u=t[2],s=t[3],c=t[4],f=t[5],l=t[6],m=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a+c*r,e[1]=i*a+f*r,e[2]=u*a+l*r,e[3]=s*a+m*r,e[4]=c*a-o*r,e[5]=f*a-i*r,e[6]=l*a-u*r,e[7]=m*a-s*r,e}function S(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function y(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function F(e,t,n){let r,a,o,u=n[0],s=n[1],c=n[2],f=Math.hypot(u,s,c);return f<i?null:(u*=f=1/f,s*=f,c*=f,r=Math.sin(t),o=1-(a=Math.cos(t)),e[0]=u*u*o+a,e[1]=s*u*o+c*r,e[2]=c*u*o-s*r,e[3]=0,e[4]=u*s*o-c*r,e[5]=s*s*o+a,e[6]=c*s*o+u*r,e[7]=0,e[8]=u*c*o+s*r,e[9]=s*c*o-u*r,e[10]=c*c*o+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function L(e,t){let n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function I(e,t){let n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function w(e,t){let n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function N(e,t,n){let r=t[0],a=t[1],o=t[2],i=t[3],u=r+r,s=a+a,c=o+o,f=r*u,l=r*s,m=r*c,h=a*s,d=a*c,_=o*c,E=i*u,v=i*s,p=i*c;return e[0]=1-(h+_),e[1]=l+p,e[2]=m-v,e[3]=0,e[4]=l-p,e[5]=1-(f+_),e[6]=d+E,e[7]=0,e[8]=m+v,e[9]=d-E,e[10]=1-(f+h),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function X(e,t){let n=new u(3),r=-t[0],a=-t[1],o=-t[2],i=t[3],s=t[4],c=t[5],f=t[6],l=t[7],m=r*r+a*a+o*o+i*i;return m>0?(n[0]=2*(s*i+l*r+c*o-f*a)/m,n[1]=2*(c*i+l*a+f*r-s*o)/m,n[2]=2*(f*i+l*o+s*a-c*r)/m):(n[0]=2*(s*i+l*r+c*o-f*a),n[1]=2*(c*i+l*a+f*r-s*o),n[2]=2*(f*i+l*o+s*a-c*r)),N(e,t,n),e}function D(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function B(e,t){let n=t[0],r=t[1],a=t[2],o=t[4],i=t[5],u=t[6],s=t[8],c=t[9],f=t[10];return e[0]=Math.hypot(n,r,a),e[1]=Math.hypot(o,i,u),e[2]=Math.hypot(s,c,f),e}function C(e,t){let n=new u(3);B(n,t);let r=1/n[0],a=1/n[1],o=1/n[2],i=t[0]*r,s=t[1]*a,c=t[2]*o,f=t[4]*r,l=t[5]*a,m=t[6]*o,h=t[8]*r,d=t[9]*a,_=t[10]*o,E=i+l+_,v=0;return E>0?(v=2*Math.sqrt(E+1),e[3]=.25*v,e[0]=(m-d)/v,e[1]=(h-c)/v,e[2]=(s-f)/v):i>l&&i>_?(v=2*Math.sqrt(1+i-l-_),e[3]=(m-d)/v,e[0]=.25*v,e[1]=(s+f)/v,e[2]=(h+c)/v):l>_?(v=2*Math.sqrt(1+l-i-_),e[3]=(h-c)/v,e[0]=(s+f)/v,e[1]=.25*v,e[2]=(m+d)/v):(v=2*Math.sqrt(1+_-i-l),e[3]=(s-f)/v,e[0]=(h+c)/v,e[1]=(m+d)/v,e[2]=.25*v),e}function V(e,t,n,r){let a=t[0],o=t[1],i=t[2],u=t[3],s=a+a,c=o+o,f=i+i,l=a*s,m=a*c,h=a*f,d=o*c,_=o*f,E=i*f,v=u*s,p=u*c,T=u*f,g=r[0],M=r[1],R=r[2];return e[0]=(1-(d+E))*g,e[1]=(m+T)*g,e[2]=(h-p)*g,e[3]=0,e[4]=(m-T)*M,e[5]=(1-(l+E))*M,e[6]=(_+v)*M,e[7]=0,e[8]=(h+p)*R,e[9]=(_-v)*R,e[10]=(1-(l+d))*R,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function O(e,t,n,r,a){let o=t[0],i=t[1],u=t[2],s=t[3],c=o+o,f=i+i,l=u+u,m=o*c,h=o*f,d=o*l,_=i*f,E=i*l,v=u*l,p=s*c,T=s*f,g=s*l,M=r[0],R=r[1],x=r[2],b=a[0],A=a[1],U=a[2],P=(1-(_+v))*M,S=(h+g)*M,y=(d-T)*M,F=(h-g)*R,L=(1-(m+v))*R,I=(E+p)*R,w=(d+T)*x,N=(E-p)*x,X=(1-(m+_))*x;return e[0]=P,e[1]=S,e[2]=y,e[3]=0,e[4]=F,e[5]=L,e[6]=I,e[7]=0,e[8]=w,e[9]=N,e[10]=X,e[11]=0,e[12]=n[0]+b-(P*b+F*A+w*U),e[13]=n[1]+A-(S*b+L*A+N*U),e[14]=n[2]+U-(y*b+I*A+X*U),e[15]=1,e}function G(e,t){let n=t[0],r=t[1],a=t[2],o=t[3],i=n+n,u=r+r,s=a+a,c=n*i,f=r*i,l=r*u,m=a*i,h=a*u,d=a*s,_=o*i,E=o*u,v=o*s;return e[0]=1-l-d,e[1]=f+v,e[2]=m-E,e[3]=0,e[4]=f-v,e[5]=1-c-d,e[6]=h+_,e[7]=0,e[8]=m+E,e[9]=h-_,e[10]=1-c-l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function H(e,t,n,r,a,o,i){let u=1/(n-t),s=1/(a-r),c=1/(o-i);return e[0]=2*o*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*s,e[6]=0,e[7]=0,e[8]=(n+t)*u,e[9]=(a+r)*s,e[10]=(i+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=i*o*2*c,e[15]=0,e}function k(e,t,n,r,a){let o,i=1/Math.tan(t/2);return e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(o=1/(r-a),e[10]=(a+r)*o,e[14]=2*a*r*o):(e[10]=-1,e[14]=-2*r),e}function z(e,t,n,r){let a=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),i=Math.tan(t.leftDegrees*Math.PI/180),u=Math.tan(t.rightDegrees*Math.PI/180),s=2/(i+u),c=2/(a+o);return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(i-u)*s*.5,e[9]=(a-o)*c*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function q(e,t,n,r,a,o,i){let u=1/(t-n),s=1/(r-a),c=1/(o-i);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*u,e[13]=(a+r)*s,e[14]=(i+o)*c,e[15]=1,e}function Y(e,t,n,r){let a,o,u,s,c,f,l,m,h,d,_=t[0],v=t[1],p=t[2],T=r[0],g=r[1],M=r[2],R=n[0],x=n[1],b=n[2];return Math.abs(_-R)<i&&Math.abs(v-x)<i&&Math.abs(p-b)<i?E(e):(l=_-R,m=v-x,h=p-b,a=g*(h*=d=1/Math.hypot(l,m,h))-M*(m*=d),o=M*(l*=d)-T*h,u=T*m-g*l,(d=Math.hypot(a,o,u))?(a*=d=1/d,o*=d,u*=d):(a=0,o=0,u=0),s=m*u-h*o,c=h*a-l*u,f=l*o-m*a,(d=Math.hypot(s,c,f))?(s*=d=1/d,c*=d,f*=d):(s=0,c=0,f=0),e[0]=a,e[1]=s,e[2]=l,e[3]=0,e[4]=o,e[5]=c,e[6]=m,e[7]=0,e[8]=u,e[9]=f,e[10]=h,e[11]=0,e[12]=-(a*_+o*v+u*p),e[13]=-(s*_+c*v+f*p),e[14]=-(l*_+m*v+h*p),e[15]=1,e)}function W(e,t,n,r){let a=t[0],o=t[1],i=t[2],u=r[0],s=r[1],c=r[2],f=a-n[0],l=o-n[1],m=i-n[2],h=f*f+l*l+m*m;h>0&&(f*=h=1/Math.sqrt(h),l*=h,m*=h);let d=s*m-c*l,_=c*f-u*m,E=u*l-s*f;return(h=d*d+_*_+E*E)>0&&(d*=h=1/Math.sqrt(h),_*=h,E*=h),e[0]=d,e[1]=_,e[2]=E,e[3]=0,e[4]=l*E-m*_,e[5]=m*d-f*E,e[6]=f*_-l*d,e[7]=0,e[8]=f,e[9]=l,e[10]=m,e[11]=0,e[12]=a,e[13]=o,e[14]=i,e[15]=1,e}function j(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function K(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Z(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function Q(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function $(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function J(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function ee(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function te(e,t){let n=e[0],r=e[1],a=e[2],o=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],m=e[9],h=e[10],d=e[11],_=e[12],E=e[13],v=e[14],p=e[15],T=t[0],g=t[1],M=t[2],R=t[3],x=t[4],b=t[5],A=t[6],U=t[7],P=t[8],S=t[9],y=t[10],F=t[11],L=t[12],I=t[13],w=t[14],N=t[15];return Math.abs(n-T)<=i*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(r-g)<=i*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(a-M)<=i*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(o-R)<=i*Math.max(1,Math.abs(o),Math.abs(R))&&Math.abs(u-x)<=i*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(s-b)<=i*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(c-A)<=i*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(f-U)<=i*Math.max(1,Math.abs(f),Math.abs(U))&&Math.abs(l-P)<=i*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(m-S)<=i*Math.max(1,Math.abs(m),Math.abs(S))&&Math.abs(h-y)<=i*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(d-F)<=i*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(_-L)<=i*Math.max(1,Math.abs(_),Math.abs(L))&&Math.abs(E-I)<=i*Math.max(1,Math.abs(E),Math.abs(I))&&Math.abs(v-w)<=i*Math.max(1,Math.abs(v),Math.abs(w))&&Math.abs(p-N)<=i*Math.max(1,Math.abs(p),Math.abs(N))}const ne=M,re=Q;function ae(){let e=new u(3);return u!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function oe(e){var t=new u(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ie(e){let t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function ue(e,t,n){let r=new u(3);return r[0]=e,r[1]=t,r[2]=n,r}function se(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ce(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function fe(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function le(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function me(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function he(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function de(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function _e(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Ee(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function ve(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function pe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Te(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function ge(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function Me(e,t){let n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return Math.hypot(n,r,a)}function Re(e,t){let n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return n*n+r*r+a*a}function xe(e){let t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function be(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Ae(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Ue(e,t){let n=t[0],r=t[1],a=t[2],o=n*n+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function Pe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Se(e,t,n){let r=t[0],a=t[1],o=t[2],i=n[0],u=n[1],s=n[2];return e[0]=a*s-o*u,e[1]=o*i-r*s,e[2]=r*u-a*i,e}function ye(e,t,n,r){let a=t[0],o=t[1],i=t[2];return e[0]=a+r*(n[0]-a),e[1]=o+r*(n[1]-o),e[2]=i+r*(n[2]-i),e}function Fe(e,t,n,r,a,o){let i=o*o,u=i*(2*o-3)+1,s=i*(o-2)+o,c=i*(o-1),f=i*(3-2*o);return e[0]=t[0]*u+n[0]*s+r[0]*c+a[0]*f,e[1]=t[1]*u+n[1]*s+r[1]*c+a[1]*f,e[2]=t[2]*u+n[2]*s+r[2]*c+a[2]*f,e}function Le(e,t,n,r,a,o){let i=1-o,u=i*i,s=o*o,c=u*i,f=3*o*u,l=3*s*i,m=s*o;return e[0]=t[0]*c+n[0]*f+r[0]*l+a[0]*m,e[1]=t[1]*c+n[1]*f+r[1]*l+a[1]*m,e[2]=t[2]*c+n[2]*f+r[2]*l+a[2]*m,e}function Ie(e,t){t=t||1;let n=2*s()*Math.PI,r=2*s()-1,a=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=r*t,e}function we(e,t,n){let r=t[0],a=t[1],o=t[2],i=n[3]*r+n[7]*a+n[11]*o+n[15];return i=i||1,e[0]=(n[0]*r+n[4]*a+n[8]*o+n[12])/i,e[1]=(n[1]*r+n[5]*a+n[9]*o+n[13])/i,e[2]=(n[2]*r+n[6]*a+n[10]*o+n[14])/i,e}function Ne(e,t,n){let r=t[0],a=t[1],o=t[2];return e[0]=r*n[0]+a*n[3]+o*n[6],e[1]=r*n[1]+a*n[4]+o*n[7],e[2]=r*n[2]+a*n[5]+o*n[8],e}function Xe(e,t,n){let r=n[0],a=n[1],o=n[2],i=n[3],u=t[0],s=t[1],c=t[2],f=a*c-o*s,l=o*u-r*c,m=r*s-a*u,h=a*m-o*l,d=o*f-r*m,_=r*l-a*f,E=2*i;return f*=E,l*=E,m*=E,h*=2,d*=2,_*=2,e[0]=u+f+h,e[1]=s+l+d,e[2]=c+m+_,e}function De(e,t,n,r){let a=[],o=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],o[0]=a[0],o[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),o[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function Be(e,t,n,r){let a=[],o=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],o[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),o[1]=a[1],o[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function Ce(e,t,n,r){let a=[],o=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],o[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),o[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),o[2]=a[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function Ve(e,t){let n=ue(e[0],e[1],e[2]),r=ue(t[0],t[1],t[2]);Ue(n,n),Ue(r,r);let a=Pe(n,r);return a>1?0:a<-1?Math.PI:Math.acos(a)}function Oe(e){return e[0]=0,e[1]=0,e[2]=0,e}function Ge(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function He(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function ke(e,t){let n=e[0],r=e[1],a=e[2],o=t[0],u=t[1],s=t[2];return Math.abs(n-o)<=i*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-u)<=i*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-s)<=i*Math.max(1,Math.abs(a),Math.abs(s))}const ze=le,qe=me,Ye=he,We=Me,je=Re,Ke=ie,Ze=xe,Qe=function(){let e=ae();return function(t,n,r,a,o,i){let u,s;for(n||(n=3),r||(r=0),s=a?Math.min(a*n+r,t.length):t.length,u=r;u<s;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],o(e,e,i),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2];return t}}();function $e(e){let t=e[0],n=e[1],r=e[2],a=e[3];return Math.hypot(t,n,r,a)}function Je(e){let t=e[0],n=e[1],r=e[2],a=e[3];return t*t+n*n+r*r+a*a}!function(){let e=function(){let e=new u(4);return u!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}();function et(){let e=new u(4);return u!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function tt(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function nt(e,t,n){n*=.5;let r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function rt(e,t){let n=2*Math.acos(t[3]),r=Math.sin(n/2);return r>i?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function at(e,t,n){let r=t[0],a=t[1],o=t[2],i=t[3],u=n[0],s=n[1],c=n[2],f=n[3];return e[0]=r*f+i*u+a*c-o*s,e[1]=a*f+i*s+o*u-r*c,e[2]=o*f+i*c+r*s-a*u,e[3]=i*f-r*u-a*s-o*c,e}function ot(e,t,n){n*=.5;let r=t[0],a=t[1],o=t[2],i=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s+i*u,e[1]=a*s+o*u,e[2]=o*s-a*u,e[3]=i*s-r*u,e}function it(e,t,n){n*=.5;let r=t[0],a=t[1],o=t[2],i=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s-o*u,e[1]=a*s+i*u,e[2]=o*s+r*u,e[3]=i*s-a*u,e}function ut(e,t,n){n*=.5;let r=t[0],a=t[1],o=t[2],i=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s+a*u,e[1]=a*s-r*u,e[2]=o*s+i*u,e[3]=i*s-o*u,e}function st(e,t){let n=t[0],r=t[1],a=t[2];return e[0]=n,e[1]=r,e[2]=a,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-a*a)),e}function ct(e,t,n,r){let a,o,u,s,c,f=t[0],l=t[1],m=t[2],h=t[3],d=n[0],_=n[1],E=n[2],v=n[3];return(o=f*d+l*_+m*E+h*v)<0&&(o=-o,d=-d,_=-_,E=-E,v=-v),1-o>i?(a=Math.acos(o),u=Math.sin(a),s=Math.sin((1-r)*a)/u,c=Math.sin(r*a)/u):(s=1-r,c=r),e[0]=s*f+c*d,e[1]=s*l+c*_,e[2]=s*m+c*E,e[3]=s*h+c*v,e}function ft(e){let t=s(),n=s(),r=s(),a=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*n),e[1]=a*Math.cos(2*Math.PI*n),e[2]=o*Math.sin(2*Math.PI*r),e[3]=o*Math.cos(2*Math.PI*r),e}function lt(e,t){let n=t[0],r=t[1],a=t[2],o=t[3],i=n*n+r*r+a*a+o*o,u=i?1/i:0;return e[0]=-n*u,e[1]=-r*u,e[2]=-a*u,e[3]=o*u,e}function mt(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function ht(e,t){let n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);let a=(r+1)%3,o=(r+2)%3;n=Math.sqrt(t[3*r+r]-t[3*a+a]-t[3*o+o]+1),e[r]=.5*n,n=.5/n,e[3]=(t[3*a+o]-t[3*o+a])*n,e[a]=(t[3*a+r]+t[3*r+a])*n,e[o]=(t[3*o+r]+t[3*r+o])*n}return e}function dt(e,t,n,r){let a=.5*Math.PI/180;t*=a,n*=a,r*=a;let o=Math.sin(t),i=Math.cos(t),u=Math.sin(n),s=Math.cos(n),c=Math.sin(r),f=Math.cos(r);return e[0]=o*s*f-i*u*c,e[1]=i*u*f+o*s*c,e[2]=i*s*c-o*u*f,e[3]=i*s*f+o*u*c,e}function _t(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const Et=function(e){let t=new u(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},vt=function(e,t,n,r){let a=new u(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=r,a},pt=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Tt=function(e,t,n,r,a){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e},gt=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},Mt=at,Rt=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},xt=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},bt=function(e,t,n,r){let a=t[0],o=t[1],i=t[2],u=t[3];return e[0]=a+r*(n[0]-a),e[1]=o+r*(n[1]-o),e[2]=i+r*(n[2]-i),e[3]=u+r*(n[3]-u),e},At=$e,Ut=At,Pt=Je,St=Pt,yt=function(e,t){let n=t[0],r=t[1],a=t[2],o=t[3],i=n*n+r*r+a*a+o*o;return i>0&&(i=1/Math.sqrt(i)),e[0]=n*i,e[1]=r*i,e[2]=a*i,e[3]=o*i,e},Ft=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Lt=function(e,t){let n=e[0],r=e[1],a=e[2],o=e[3],u=t[0],s=t[1],c=t[2],f=t[3];return Math.abs(n-u)<=i*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-s)<=i*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-c)<=i*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(o-f)<=i*Math.max(1,Math.abs(o),Math.abs(f))},It=function(){let e=ae(),t=ue(1,0,0),n=ue(0,1,0);return function(r,a,o){let i=Pe(a,o);return i<-.999999?(Se(e,t,a),Ke(e)<1e-6&&Se(e,n,a),Ue(e,e),nt(r,e,Math.PI),r):i>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Se(e,a,o),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+i,yt(r,r))}}(),wt=function(){let e=et(),t=et();return function(n,r,a,o,i,u){return ct(e,r,i,u),ct(t,a,o,u),ct(n,e,t,2*u*(1-u)),n}}(),Nt=function(){let e=function(){let e=new u(9);return u!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}();return function(t,n,r,a){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=a[0],e[4]=a[1],e[7]=a[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],yt(t,ht(t,e))}}();!function(){let e=function(){let e=new u(2);return u!=Float32Array&&(e[0]=0,e[1]=0),e}()}();const Xt={POSITION:0,NORMAL:1,TEXCOORD_0:2,COLOR_0:3,TANGENT:4,WEIGHTS_0:5,JOINTS_0:6},Dt={VEC2:2,VEC3:3,VEC4:4,SCALAR:1},Bt={view:"view",perspective:"perspective",env_map:"env_map",diffuse_map:"diffuse_map",prefilter_map:"prefilter_map",brdflut_map:"brdflut_map"},Ct={translation:3,rotation:4,scale:3,matrix:16};var Vt=n(0),Ot="",Gt="",Ht="\nlayout( location = 0 ) in vec3 position;\n\nuniform mat4 perspective;\nuniform mat4 view;\nuniform mat4 model;\n\nvoid main(){\n    gl_Position = perspective*view*model*vec4(position, 1.0);\n}\n",kt="\n    precision mediump float;\n    out vec4 color;\n    void main(){\n        color = vec4(1.0, 0.0, 0.0, 1.0);\n    }\n",zt="\nlayout( location = 0 ) in vec3 position;\nlayout( location = 1 ) in vec3 normal;\nlayout( location = 2 ) in vec2 texcoords;\n\nuniform mat4 perspective;\nuniform mat4 view;\nuniform mat4 model;\n\nout vec3 v_position;\nout vec3 v_normal;\nout vec2 v_texcoords;\n\nvoid main(){\n    gl_Position = perspective*view*model*vec4(position, 1.0);\n    v_position = (view*model*vec4(position, 1.0)).xyz;\n    v_normal = mat3(transpose(inverse(view*model))) * normal;\n    v_texcoords = texcoords;\n}\n",qt="\n#define NUM_LIGHTS 1\nprecision mediump float;\n\nin vec3 v_position;\nin vec3 v_normal;\nin vec2 v_texcoords;\n\nuniform sampler2D emissiveTexture;\nvec3 emissive;\n\nuniform sampler2D normalTexture;\n\nvec3 normal;\n\nuniform sampler2D occlusionTexture;\nfloat occlusion;\n\nuniform sampler2D baseColorTexture;\nvec4 base_color;\n\nuniform sampler2D metallicRoughnessTexture;\nfloat roughness;\nfloat metallic;\n\nuniform samplerCube env_map;\nuniform samplerCube diffuse_map;\nuniform samplerCube prefilter_map;\nuniform sampler2D brdflut_map;\n\n//light variables\nvec3 light_positions[1];\nvec3 light_colors[1];\n\nconst float PI = 3.14159265359;\n\n//set lights functions\nvoid set_lights(){\n  light_positions[0] = vec3(5);\n  light_colors[0] = vec3(10);\n}\n\n//length function \n/*float length(vec3 operand){\n  return sqrt((operand.x*operand.x)+(operand.y*operand.y)+(operand.z*operand.z));\n}*/\nout vec4 color;\n\n//pbr functions\nvec3 fresnelSchlick(float cosTheta, vec3 F0)\n{\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\n}  \n\nvec3 fresnelSchlickRoughness(float cosTheta, vec3 F0, float roughness)\n{\n  return F0 + (max(vec3(1.0 - roughness), F0) - F0) * pow(1.0 - cosTheta, 5.0);\n}  \n\nfloat DistributionGGX(vec3 N, vec3 H, float roughness)\n{\n    float a      = roughness*roughness;\n    float a2     = a*a;\n    float NdotH  = max(dot(N, H), 0.0);\n    float NdotH2 = NdotH*NdotH;\n\t\n    float num   = a2;\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\n    denom = PI * denom * denom;\n\t\n    return num / denom;\n}\n\nfloat GeometrySchlickGGX(float NdotV, float roughness)\n{\n    float r = (roughness + 1.0);\n    float k = (r*r) / 8.0;\n\n    float num   = NdotV;\n    float denom = NdotV * (1.0 - k) + k;\n\t\n    return num / denom;\n}\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness)\n{\n    float NdotV = max(dot(N, V), 0.0);\n    float NdotL = max(dot(N, L), 0.0);\n    float ggx2  = GeometrySchlickGGX(NdotV, roughness);\n    float ggx1  = GeometrySchlickGGX(NdotL, roughness);\n\t\n    return ggx1 * ggx2;\n}\n\nvec3 getNormal(){\n  vec3 pos_dx = dFdx(v_position);\n  vec3 pos_dy = dFdy(v_position);\n  vec3 tex_dx = dFdx(vec3(v_texcoords, 0.0));\n  vec3 tex_dy = dFdy(vec3(v_texcoords, 0.0));\n  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n\n  vec3 ng = v_normal;\n\n  t = normalize(t - ng * dot(ng, t));\n  vec3 b = normalize(cross(ng, t));\n  mat3 tbn = mat3(t, b, ng);\n\n  #ifdef NORMALTEXTURE\n  vec3 n = texture(normalTexture, v_texcoords).rgb;\n  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(1, 1, 1.0)));\n  #else\nvec3 n = tbn[2].xyz;\n#endif\n\n  return n;\n}\n \nvoid main() {\n  //set lights\n  set_lights();\n\n  //set material info\n  #ifdef BASECOLORTEXTURE\n  base_color = texture(baseColorTexture, v_texcoords);\n  #endif\n\n  normal = getNormal();\n\n  #ifdef METALLICROUGHNESSTEXTURE\n  metallic = texture(metallicRoughnessTexture, v_texcoords).b;\n  roughness = texture(metallicRoughnessTexture, v_texcoords).g;\n  #endif\n\n  #ifdef OCCLUSIONTEXTURE\n  occlusion = texture(occlusionTexture, v_texcoords).r;\n  #endif\n\n  #ifdef EMISSIVETEXTURE\n  emissive = texture(emissiveTexture, v_texcoords).rgb;\n  #endif\n\n  //set geometry info\n  vec3 n = normalize(normal);\n  vec3 v = normalize(-v_position);\n  vec3 R = -normalize(reflect(v, n));   \n\n\n  //calculate surface reflectivity for fresnel schlick\n  vec3 f0 = vec3(0.04);\n  f0 = mix(f0, base_color.rgb, metallic);\n\n  //init radiance\n  vec3 Lo = vec3(0.0);\n  for(int i = 0; i < NUM_LIGHTS; ++i){\n\n    //calculate light vector\n    vec3 l = normalize(light_positions[i] - v_position);\n\n    //calculate halfway vector\n    vec3 h = normalize(l+v);\n\n    float distance    = length(light_positions[i] - v_position);\n    float attenuation = 1.0 / (distance * distance);\n    vec3 radiance     = light_colors[i] * attenuation;        \n    \n    // cook-torrance brdf\n    float NDF = DistributionGGX(n, h, roughness);        \n    float G   = GeometrySmith(n, v, l, roughness);      \n    vec3 F    = fresnelSchlickRoughness(max(dot(n, v), 0.0), f0, roughness);;       \n    \n      \n    \n    //calculate specular component\n    vec3 numerator    = NDF * G * F;\n    float denominator = 4.0 * max(dot(n, v), 0.0) * max(dot(n, l), 0.0) + 0.001;\n    vec3 specular     = numerator / denominator;  \n    \n    //calulate diffuse\n    vec3 kS = F;\n    vec3 kD = vec3(1.0) - kS;\n    kD *= 1.0 - metallic;\t\n\n    // integrate to outgoing radiance Lo\n    float NdotL = max(dot(n, l), 0.0);                \n    Lo += (kD * base_color.rgb / PI + specular) * radiance * NdotL;\n  }\n\n  vec3 F = fresnelSchlickRoughness(max(dot(n, v), 0.0), f0, roughness);\n\n  //diffuse ibl\n  vec3 kS = F;\n  vec3 kD = vec3(1.0) - kS;\n  kD *= 1.0 - metallic;\t  \n  vec3 irradiance = texture(diffuse_map, n).rgb;\n  vec3 diffuse    = irradiance * base_color.rgb;\n\n  //calculate speculare ibl\n  const float MAX_REFLECTION_LOD = 40.0;\n  vec3 prefilteredColor = texture(prefilter_map, R,  roughness).rgb;   \n  vec2 envBRDF  = texture(brdflut_map, vec2(max(dot(n, v), 0.0), roughness)).rg;\n  vec3 specular = prefilteredColor * (F * envBRDF.x + envBRDF.y);\n  vec3 ambient    = (kD * diffuse + (specular)) ; \n  \n  vec3 c = ambient + Lo;\n\n  #ifdef OCCLUSIONTEXTURE\n  c *= occlusion;\n  #endif\n\n  #ifdef EMISSIVETEXTURE\n  c+=emissive;\n  #endif\n\n  //c = c / (c + vec3(1.0));\n  c = pow(c, vec3(1.0/1.8));\n\n  //set color \n  color = vec4(c, 1);\n\n}\n";Math.clamp=function(e,t,n){return Math.min(Math.max(e,t),n)};class Yt{constructor(e,t,n,o){this.fovy=e,this.aspect=t,this.near=n,this.far=o,this.perspective_matrix=r.create(),r.perspective(this.perspective_matrix,this.fovy,this.aspect,this.near,this.far),this.eye=a.fromValues(0,0,1),this.target=a.fromValues(0,0,0),this.up=a.fromValues(0,1,0),this.view_matrix=r.create(),r.lookAt(this.view_matrix,this.eye,this.target,this.up)}set_perspective_uniform(e,t){e.uniformMatrix4fv(t,!1,this.perspective_matrix)}set_view_uniform(e,t){e.uniformMatrix4fv(t,!1,this.view_matrix)}set_orbit_controls(e,t,n){this.mousedown=!1,this.temp_mouse_x=0,this.temp_mouse_y=0,this.distance=7*Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),console.log(this.distance),r.perspective(this.perspective_matrix,this.fovy,this.aspect,this.near,10*this.distance),this.angle1=0,this.angle2=0,this.gain=10,this.eye=a.fromValues(this.distance,0,0),this.target=a.fromValues((t[0]+n[0])/2,(t[1]+n[1])/2,(t[2]+n[2])/2),r.lookAt(this.view_matrix,this.eye,this.target,this.up),e.canvas.addEventListener("mousedown",e=>{this.mousedown=!0,this.temp_mouse_x=e.clientX,this.temp_mouse_y=e.clientY,this.temp_angle_1=this.angle1,this.temp_angle_2=this.angle2}),e.canvas.addEventListener("mouseup",e=>{this.mousedown=!1}),e.canvas.addEventListener("mousemove",e=>{if(this.mousedown){var t=e.clientX,n=e.clientY,o=this.gain*(t-this.temp_mouse_x)/window.innerWidth,i=this.gain*(n-this.temp_mouse_y)/window.innerHeight;this.angle1=this.temp_angle_1+o,this.angle2=Math.clamp(-Math.PI/2,this.temp_angle_2+i,Math.PI/2);var u=this.distance*Math.cos(this.angle2),s=this.distance*Math.sin(this.angle2)+this.target[1],c=u*Math.cos(this.angle1)+this.target[0],f=u*Math.sin(this.angle1)+this.target[2];this.eye=a.fromValues(c,s,f),r.lookAt(this.view_matrix,this.eye,this.target,this.up)}}),e.canvas.addEventListener("wheel",e=>{e.preventDefault();var t=.1*a.dist(this.eye,this.target);e.deltaY<0&&(this.distance-=t),e.deltaY>0&&(this.distance+=t);var n=this.distance*Math.cos(this.angle2),o=this.distance*Math.sin(this.angle2)+this.target[1],i=n*Math.cos(this.angle1)+this.target[0],u=n*Math.sin(this.angle1)+this.target[2];this.eye=a.fromValues(i,o,u),r.lookAt(this.view_matrix,this.eye,this.target,this.up)}),e.canvas.addEventListener("contextmenu",e=>{e.preventDefault()})}}function Wt(e,t){return Ot="",Gt="",jt(t,"text").then(function(e){return Ot=e.responseURL,Gt=Ot.slice(0,Ot.lastIndexOf("/")+1),JSON.parse(e.responseText)}).then(function(t){return function(e,t,n){t._max=a.fromValues(0,0,0),t._min=a.fromValues(0,0,0),t._loads=[],t._renders=[],t._animations=[],null==n&&(n=0);var r=t.scenes[n].nodes;if(0==r.length)return!1;!function(e,t){var n=t._default_material={};n._is_defualt=!0,n._shader_program=nn(e,[],Ht,kt)}(e,t);for(var o=0;o<r.length;o++)en(e,t,r[o]);if(t.animations)for(var o=0;o<t.animations.length;o++)$t(e,t,t.animations[o]);on(e,t),t._camera=new Yt(.2,e.canvas.width/e.canvas.height,.1,100),t._animate=t.animations&&t._animations?function(e){t._animations[0](e)}:()=>{};var i,u,s=Kt()/1e3;return t._render=function(){i=Kt()/1e3,u=s-i,t._animate(u),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.enable(e.DEPTH_TEST),t._renders.forEach(e=>{e()}),s=i,requestAnimationFrame(t._render)},Promise.all(t._loads).then(()=>(t._camera.set_orbit_controls(e,t._max,t._min),t))}(e,t)})}function jt(e,t){-1==e.search("data:")&&(e=Gt+e);var n=new XMLHttpRequest;return new Promise(function(r,a){n.onreadystatechange=()=>{if(4!==n.readyState)return!1;4==n.readyState&&200==n.status?r(n):a({status:n.status,statusText:n.statusText})},n.open("GET",e),t&&(n.responseType=t),n.send()})}function Kt(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}function Zt(e,t,n,r,a,o){var i=t.accessors[n],u=t.bufferViews[i.bufferView],s=t.buffers[u.buffer];s._onload||(s._onload=jt(s.uri,"arraybuffer"),t._loads.push(s._onload)),s._onload.then(e=>{var t=u.byteOffset,n=u.byteLength;i.byteOffset&&(t+=i.byteOffset,n-=i.byteOffset),console.log(n);var s=new Float32Array(e.response,t,i.count*Dt[i.type]);console.log(s),a?(r._inputs=s,r._max_input=-1e5,r._min_input=1e5,r._inputs.forEach(e=>{e>r._max_input&&(r._max_input=e),e<r._min_input&&(r._min_input=e)}),r._min_input<o._min_time&&(o._min_time=r._min_input),r._max_input>o._max_time&&(o._max_time=r._max_input)):r._outputs=s})}function Qt(e,t,n,r){console.log("processing sampler"),Zt(0,t,n.input,n,!0,r),Zt(0,t,n.output,n,!1,r)}function $t(e,t,n){if(n.name=n.name?n.name:"unnamed_anim",n._min_time=1e5,n._max_time=-1e5,n.samplers)for(var r=0;r<n.samplers.length;r++)Qt(0,t,n.samplers[r],n);var a=0;n._animate=function(e){(a+=Math.abs(e))>n._max_time&&(a=n._min_time),n.channels.forEach(e=>{var r=t.nodes[e.target.node],o=(r[e.target.path],n.samplers[e.sampler]);if(!(a<o._min_input||a>o._max_input)){var i=1e5,u=1e5,s=0,c=0,f=[void 0,void 0];o._inputs&&o._inputs.forEach((e,t)=>{var n=a-e;n>0?Math.abs(n)<i&&(s=e,f[0]=t,i=Math.abs(n)):Math.abs(n)<u&&(c=e,f[1]=t,u=Math.abs(n))});for(var l,m=(a-s)/(c-s),h=[],d=[],_=[],E=0;E<Ct[e.target.path];E++)d.push(o._outputs[f[0]*Ct[e.target.path]+E]),_.push(o._outputs[f[1]*Ct[e.target.path]+E]),l=_[E]-d[E],h.push(d[E]+m*l);r[e.target.path]=h,console.log(e.target.path+":"+h),function e(t,n,r){if(Jt(n,r),n.children)for(var a=0;a<n.children.length;a++)e(t,t.nodes[n.children[a]],n)}(t,r)}})},t._animations.push(n._animate)}function Jt(e,t){var n=r.create();if(r.identity(n),e.matrix)n=r.clone(e.matrix);else{e.translation||(e.translation=a.fromValues(0,0,0)),e.rotation||(e.rotation=o.create(),o.identity(e.rotation)),e.scale||(e.scale=a.create(),e.scale=a.fromValues(1,1,1));var i=o.create();o.normalize(i,o.fromValues(...e.rotation)),r.fromRotationTranslation(n,i,e.translation),r.scale(n,n,e.scale)}e._model=null!=t?r.multiply(r.create(),t._model,n):n}function en(e,t,n,r){var a=t.nodes[n];if(Jt(a,null!=r?t.nodes[r]:void 0),a.mesh>=0&&function(e,t,n,r){var a=t.meshes[n];if(a.primitives)for(var o=0;o<a.primitives.length;o++){var i,u,s=a.primitives[o];if(s._vao=e.createVertexArray(),e.bindVertexArray(s._vao),s.attributes)for(const n in s.attributes)tn(e,t,s.attributes[n],n,s._vao);s.indices>=0?(tn(e,t,s.indices,void 0,s._vao),i=t.accessors[s.indices]):console.log("This mesh does not have an index buffer"),e.bindVertexArray(null),s.material>=0?(rn(e,t,s.material),u=t.materials[s.material]):u=t._default_material,s._render=function(){e.bindVertexArray(s._vao),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i._buffer),e.useProgram(u._shader_program);var n=e.getUniformLocation(u._shader_program,"perspective"),a=e.getUniformLocation(u._shader_program,"view");e.uniformMatrix4fv(n,e.FALSE,t._camera.perspective_matrix),e.uniformMatrix4fv(a,e.FALSE,t._camera.view_matrix);var o=e.getUniformLocation(u._shader_program,"model");e.uniformMatrix4fv(o,e.FALSE,r._model);var c=0;if(!u._is_defualt){u._textures.forEach(n=>{var r=u._uniform_locs[n.name],a=t.textures[n.index];e.activeTexture(e.TEXTURE0+c),e.bindTexture(e.TEXTURE_2D,a._buffer),e.uniform1i(r,c),c++});var f=e.getUniformLocation(u._shader_program,"diffuse_map"),l=e.getUniformLocation(u._shader_program,"prefilter_map"),m=e.getUniformLocation(u._shader_program,"brdflut_map");t._environment.set_diffuse_uniform(e,c,f),t._environment.set_prefilter_uniform(e,++c,l),t._environment.set_brdflut_uniform(e,++c,m)}e.drawElements(e.TRIANGLES,i.count,i.componentType,0)},t._renders.push(s._render)}}(e,t,a.mesh,a),a.skin>=0&&function(e,t,n,r){var a=t.skins[n];a.inverseBindMatrices>=0&&function(e,t,n,r){var a=t.accessors[n],o=t.bufferViews[a.bufferView],i=t.buffers[o.buffer];i._onload||(i._onload=jt(i.uri,"arraybuffer"),t._loads.push(i._onload));r._inverseBindMatrices=[],i._onload.then(e=>{var t=o.byteOffset;o.byteLength;a.byteOffset&&(t+=a.byteOffset,a.byteOffset);var n=new Float32Array(e.response,t,a.count*Dt[a.type]);for(let e=0;e<n.length;e+=16){const t=array.slice(e,e+16);r._inverseBindMatrices.push(t)}})}(0,t,a.inverseBindMatrices,a)}(0,t,a.skin),a.children)for(var o=0;o<a.children.length;o++)en(e,t,a.children[o],a)}function tn(e,t,n,r,a){var o=t.accessors[n];o._buffer=e.createBuffer();var i=t.bufferViews[o.bufferView],u=t.buffers[i.buffer];u._onload||(u._onload=jt(u.uri,"arraybuffer"),t._loads.push(u._onload)),u._onload.then(n=>{var u=i.byteOffset,s=i.byteLength;if(o.byteOffset&&(u+=o.byteOffset,s-=o.byteOffset),e.bindVertexArray(a),null!=r){var c=new Float32Array(n.response,u,s/Float32Array.BYTES_PER_ELEMENT);e.bindBuffer(e.ARRAY_BUFFER,o._buffer),e.bufferData(e.ARRAY_BUFFER,c,e.STATIC_DRAW),e.enableVertexAttribArray(Xt[r]),e.vertexAttribPointer(Xt[r],Dt[o.type],o.componentType,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,null),"POSITION"==r&&(t._min[0]=t._min[0]>o.min[0]?o.min[0]:t._min[0],t._min[1]=t._min[1]>o.min[1]?o.min[1]:t._min[1],t._min[2]=t._min[2]>o.min[2]?o.min[2]:t._min[2],t._max[0]=t._max[0]<o.max[0]?o.max[0]:t._max[0],t._max[1]=t._max[1]<o.max[1]?o.max[1]:t._max[1],t._max[2]=t._max[2]<o.max[2]?o.max[2]:t._max[2])}else{c=new Uint16Array(n.response,u,s/Uint16Array.BYTES_PER_ELEMENT);o._buffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o._buffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,c,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}})}function nn(e,t,n,r){var a="#version 300 es \n";if(null!=t)for(var o=0;o<t.length;o++){a+="#define "+t[o].toUpperCase()+"\n"}var i=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(i,a+n),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))return e.deleteShader(i),!1;var u=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(u,a+r),e.compileShader(u),!e.getShaderParameter(u,e.COMPILE_STATUS))return console.log(e.getShaderInfoLog(u)),e.deleteShader(u),!1;var s=e.createProgram();return e.attachShader(s,i),e.attachShader(s,u),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)?s:(console.log(e.getProgramInfoLog(s)),e.deleteProgram(s),!1)}function rn(e,t,n){var r=t.materials[n];r._shader_params=[],r._textures=[];for(const n in r)if("_shader_params"!=n&&"name"!=n&&"_textures"!=n&&"_uniform_locs"!=n)if(n.includes("Texture"))r._shader_params.push(n),r._textures.push({index:r[n].index,name:n}),an(e,t,r[n].index);else if(n.includes("Factor"))r._shader_params.push(n);else{var a=r[n];for(const n in a)console.log(n),n.includes("Texture")?(r._shader_params.push(n),r._textures.push({index:a[n].index,name:n}),an(e,t,a[n].index)):n.includes("Factor")&&r._shader_params.push(n)}r._shader_program=nn(e,r._shader_params,zt,qt),r._uniform_locs={},r._shader_params.forEach(t=>{r._uniform_locs[t]=e.getUniformLocation(r._shader_program,t)})}function an(e,t,n){var r=t.textures[n];r._buffer=e.createTexture();var a,o=t.images[r.source],i=r.sampler||t.samplers?t.samplers[r.sampler]:void 0;o._onload||(o._onload=(a=o.uri,-1==a.search("data:")&&(a=Gt+a),new Promise((e,t)=>{let n=new Image;n.onload=function(){e(n)},n.onerror=function(){t(new Error(`Failed to load image's URL: ${a}`))},n.src=a})).then(t=>(e.bindTexture(e.TEXTURE_2D,r._buffer),i?(i.wrapS&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,i.wrapS),i.wrapT&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,i.wrapT),i.minFilter&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i.minFilter),i.magFilter&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i.magFilter)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null),o.uri)),t._loads.push(o._onload))}function on(e,t){const n=new Float32Array([-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1]),o=e.createVertexArray(),i=e.createBuffer();e.bindVertexArray(o),e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW),e.enableVertexAttribArray(Xt.POSITION),e.vertexAttribPointer(Xt.POSITION,3,e.FLOAT,e.FALSE,0,0),e.bindVertexArray(null);var u=e.createShader(e.VERTEX_SHADER);e.shaderSource(u,"#version 300 es\n    layout( location = 0 ) in vec3 position;\n\n    uniform mat4 perspective;\n    uniform mat4 view;\n\n    out vec3 v_normal;\n\n    \n    void main(){\n        vec4 pos = perspective*view*vec4(position*vec3(100), 1.0);\n        gl_Position = pos.xyzw;\n        v_normal = position;\n    }\n    "),e.compileShader(u),e.getShaderParameter(u,e.COMPILE_STATUS)||(console.log(e.getShaderInfoLog(u)),e.deleteShader(u));var s=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(s,"#version 300 es\n    precision mediump float;\n \n    in vec3 v_normal;\n    out vec4 color;\n     \n    uniform samplerCube env_map;\n    uniform samplerCube diffuse_map;\n    uniform samplerCube prefilter_map;\n    uniform sampler2D brdflut_map;\n     \n    void main() {\n       color = texture(env_map, v_normal);\n    }\n    "),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS)||(console.log(e.getShaderInfoLog(s)),e.deleteShader(s));var c=e.createProgram();e.attachShader(c,u),e.attachShader(c,s),e.linkProgram(c),e.getProgramParameter(c,e.LINK_STATUS)||(console.log(e.getProgramInfoLog(c)),e.deleteProgram(c));var l=e.createTexture();e.bindTexture(e.TEXTURE_CUBE_MAP,l),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_MODE,e.NONE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_FUNC,e.LEQUAL);const m=[{target:e.TEXTURE_CUBE_MAP_POSITIVE_X,src:"assets/env_map/px.hdr"},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_X,src:"assets/env_map/nx.hdr"},{target:e.TEXTURE_CUBE_MAP_POSITIVE_Y,src:"assets/env_map/py.hdr"},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_Y,src:"assets/env_map/ny.hdr"},{target:e.TEXTURE_CUBE_MAP_POSITIVE_Z,src:"assets/env_map/pz.hdr"},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_Z,src:"assets/env_map/nz.hdr"}];var h=[],d={onload:null,vao:o,vert_buffer:i,texture:l,diffuse:void 0,program:c,texture_loc:e.getUniformLocation(c,Bt.env_map),diffuse_loc:e.getUniformLocation(c,Bt.diffuse_map),prefilter_loc:e.getUniformLocation(c,"prefilter_map"),brdflut_loc:e.getUniformLocation(c,"brdflut_map"),perspective_loc:e.getUniformLocation(c,Bt.perspective),view_loc:e.getUniformLocation(c,Bt.view),render:function(e,t){e.bindVertexArray(this.vao),e.useProgram(this.program),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this.texture),e.uniform1i(this.texture_loc,0),t.set_perspective_uniform(e,this.perspective_loc),t.set_view_uniform(e,this.view_loc),e.drawArrays(e.TRIANGLES,0,36),e.bindVertexArray(null)},set_texture_uniform:function(e,t,n){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_CUBE_MAP,this.texture),e.uniform1i(n,t)},set_diffuse_uniform:function(e,t,n){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_CUBE_MAP,this.diffuse),e.uniform1i(n,t)},set_prefilter_uniform:function(e,t,n){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_CUBE_MAP,this.prefilter),e.uniform1i(n,t)},set_brdflut_uniform:function(e,t,n){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.brdflut),e.uniform1i(n,t)}},_=new Promise(t=>{m.forEach(n=>{const{target:i,src:u}=n;var s=new Vt;s.onload=function(){if(h.push({image:s,target:i}),h.length>=m.length){e.bindTexture(e.TEXTURE_CUBE_MAP,l),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_MODE,e.NONE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_FUNC,e.LEQUAL);for(var n=0;n<h.length;n++)e.texImage2D(h[n].target,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,h[n].image);e.generateMipmap(e.TEXTURE_CUBE_MAP),e.bindTexture(e.TEXTURE_CUBE_MAP,null),d.diffuse=function(e,t,n){var o="#version 300 es\n    layout( location = "+Xt.POSITION+" ) in vec3 position;\n\n    uniform mat4 perspective;\n    uniform mat4 view;\n\n    out vec3 v_normal;\n\n    \n    void main(){\n        vec4 pos = perspective*view*vec4(position, 1.0);\n        gl_Position = pos.xyzw;\n        v_normal = position;\n    }",i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,o),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||(console.log(e.getShaderInfoLog(i)),e.deleteShader(i));var u=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(u,"#version 300 es\n    precision mediump float;\n \n    in vec3 v_normal;\n    out vec4 color;\n    \n    const float PI = 3.14159265359;\n     \n    uniform samplerCube env_map;\n     \n    void main() {\n        vec3 normal = normalize(v_normal);\n\n        vec3 irradiance = vec3(0.0);\n\n        vec3 up    = vec3(0.0, 1.0, 0.0);\n        vec3 right = cross(up, normal);\n        up         = cross(normal, right);\n\n        float sampleDelta = 0.025;\n        float nrSamples = 0.0; \n        for(float phi = 0.0; phi < 2.0 * PI; phi += sampleDelta)\n        {\n            for(float theta = 0.0; theta < 0.5 * PI; theta += sampleDelta)\n            {\n                // spherical to cartesian (in tangent space)\n                vec3 tangentSample = vec3(sin(theta) * cos(phi),  sin(theta) * sin(phi), cos(theta));\n                // tangent space to world\n                vec3 sampleVec = tangentSample.x * right + tangentSample.y * up + tangentSample.z * normal; \n\n                irradiance += texture(env_map, sampleVec).rgb * cos(theta) * sin(theta);\n                nrSamples++;\n            }\n        }\n        irradiance = PI * irradiance * (1.0 / float(nrSamples));\n        \n        color = vec4(irradiance, 1.0);\n    }\n    "),e.compileShader(u),e.getShaderParameter(u,e.COMPILE_STATUS)||(console.log(e.getShaderInfoLog(u)),e.deleteShader(u));var s=e.createProgram();e.attachShader(s,i),e.attachShader(s,u),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)||(console.log(e.getProgramInfoLog(s)),e.deleteProgram(s));var c=e.getUniformLocation(s,Bt.env_map),l=e.getUniformLocation(s,Bt.perspective),m=e.getUniformLocation(s,Bt.view),h=e.createTexture();e.bindTexture(e.TEXTURE_CUBE_MAP,h);for(var d=0;d<6;d++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([255,0,0,255,0,255,0,255,0,0,255,255]));e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR);var _=e.createFramebuffer();e.createRenderbuffer();e.bindFramebuffer(e.FRAMEBUFFER,_),e.bindFramebuffer(e.FRAMEBUFFER,null);var E=r.perspective(r.create(),f(90),1,.1,10),v=[r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(1,0,0),a.fromValues(0,-1,0)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(-1,0,0),a.fromValues(0,-1,0)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(0,1,0),a.fromValues(0,0,1)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(0,-1,0),a.fromValues(0,0,-1)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(0,0,1),a.fromValues(0,-1,0)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(0,0,-1),a.fromValues(0,-1,0))];e.bindVertexArray(n),e.useProgram(s),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,t),e.uniform1i(c,0),e.uniformMatrix4fv(l,e.FALSE,E),e.viewport(0,0,32,32);for(var d=0;d<6;d++)e.bindFramebuffer(e.FRAMEBUFFER,_),e.uniformMatrix4fv(m,e.FALSE,v[d]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+d,h,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.drawArrays(e.TRIANGLES,0,36);return e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteFramebuffer(_),h}(e,l,o),d.prefilter=function(e,t,n){var o=e.createTexture();e.bindTexture(e.TEXTURE_CUBE_MAP,o);for(var i=0;i<6;i++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,e.RGBA,128,128,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.generateMipmap(e.TEXTURE_CUBE_MAP);var u="#version 300 es\n    layout( location = "+Xt.POSITION+" ) in vec3 position;\n\n    uniform mat4 perspective;\n    uniform mat4 view;\n\n    out vec3 v_normal;\n    \n    void main(){\n        vec4 pos = perspective*view*vec4(position, 1.0);\n        gl_Position = pos.xyzw;\n        v_normal = position;\n    }",s=e.createShader(e.VERTEX_SHADER);e.shaderSource(s,u),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS)||(console.log(e.getShaderInfoLog(s)),e.deleteShader(s));var c=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(c,"#version 300 es\n    precision mediump float;\n    \n    const float PI = 3.14159265359;\n\n    in vec3 v_normal;\n    out vec4 color;\n\n    float VanDerCorpus(uint n, uint base)\n    {\n        float invBase = 1.0 / float(base);\n        float denom   = 1.0;\n        float result  = 0.0;\n\n        for(uint i = 0u; i < 32u; ++i)\n        {\n            if(n > 0u)\n            {\n                denom   = mod(float(n), 2.0);\n                result += denom * invBase;\n                invBase = invBase / 2.0;\n                n       = uint(float(n) / 2.0);\n            }\n        }\n\n        return result;\n    }\n    vec2 Hammersley(uint i, uint N)\n    {\n        return vec2(float(i)/float(N), VanDerCorpus(i, 2u));\n    }\n\n    vec3 ImportanceSampleGGX(vec2 Xi, vec3 N, float roughness)\n    {\n        float a = roughness*roughness;\n        \n        float phi = 2.0 * PI * Xi.x;\n        float cosTheta = sqrt((1.0 - Xi.y) / (1.0 + (a*a - 1.0) * Xi.y));\n        float sinTheta = sqrt(1.0 - cosTheta*cosTheta);\n        \n        // from spherical coordinates to cartesian coordinates\n        vec3 H;\n        H.x = cos(phi) * sinTheta;\n        H.y = sin(phi) * sinTheta;\n        H.z = cosTheta;\n        \n        // from tangent-space vector to world-space sample vector\n        vec3 up        = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n        vec3 tangent   = normalize(cross(up, N));\n        vec3 bitangent = cross(N, tangent);\n        \n        vec3 sampleVec = tangent * H.x + bitangent * H.y + N * H.z;\n        return normalize(sampleVec);\n    }  \n\n     \n    uniform samplerCube env_map;\n    uniform float roughness;  \n\n    void main() {        \n        vec3 N = normalize(v_normal);    \n        vec3 R = N;\n        vec3 V = R;\n\n        const uint SAMPLE_COUNT = 1024u;\n        float totalWeight = 0.0;   \n        vec3 prefilteredColor = vec3(0.0);     \n        for(uint i = 0u; i < SAMPLE_COUNT; ++i)\n        {\n            vec2 Xi = Hammersley(i, SAMPLE_COUNT);\n            vec3 H  = ImportanceSampleGGX(Xi, N, roughness);\n            vec3 L  = normalize(2.0 * dot(V, H) * H - V);\n\n            float NdotL = max(dot(N, L), 0.0);\n            if(NdotL > 0.0)\n            {\n                prefilteredColor += texture(env_map, L).rgb * NdotL;\n                totalWeight      += NdotL;\n            }\n        }\n        prefilteredColor = prefilteredColor / totalWeight;\n\n        color = vec4(prefilteredColor, 1.0);\n    }\n    "),e.compileShader(c),e.getShaderParameter(c,e.COMPILE_STATUS)||(console.log(e.getShaderInfoLog(c)),e.deleteShader(c));var l=e.createProgram();e.attachShader(l,s),e.attachShader(l,c),e.linkProgram(l),e.getProgramParameter(l,e.LINK_STATUS)||(console.log(e.getProgramInfoLog(l)),e.deleteProgram(l));var m=e.getUniformLocation(l,Bt.env_map),h=e.getUniformLocation(l,"roughness"),d=e.getUniformLocation(l,Bt.perspective),_=e.getUniformLocation(l,Bt.view),E=[r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(1,0,0),a.fromValues(0,-1,0)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(-1,0,0),a.fromValues(0,-1,0)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(0,1,0),a.fromValues(0,0,1)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(0,-1,0),a.fromValues(0,0,-1)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(0,0,1),a.fromValues(0,-1,0)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(0,0,-1),a.fromValues(0,-1,0))],v=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,v),e.bindVertexArray(n),e.useProgram(l),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,t),e.uniform1i(m,0),e.uniformMatrix4fv(d,e.FALSE,r.perspective(r.create(),f(90),1,.1,10)),e.bindFramebuffer(e.FRAMEBUFFER,v);for(var p=0;p<10;++p){var T=128*Math.pow(.5,p),g=128*Math.pow(.5,p);e.viewport(0,0,T,g);var M=p/9;e.uniform1f(h,M);for(var i=0;i<6;++i)e.uniformMatrix4fv(_,e.FALSE,E[i]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+i,o,p),e.clear(e.COLOR_BUFFER_BIT,e.DEPTH_BUFFER_BIT),e.drawArrays(e.TRIANGLES,0,36)}return e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteFramebuffer(v),o}(e,l,o),d.brdflut=function(e,t){const n=e.createVertexArray();var r="#version 300 es\n    layout( location = "+Xt.POSITION+" ) in vec3 position;\n\n    out vec2 v_position;\n    \n    void main(){\n        float x = float(((uint(gl_VertexID) + 2u) / 3u)%2u); \n        float y = float(((uint(gl_VertexID) + 1u) / 3u)%2u); \n\n        gl_Position = vec4(-1.0f + x*2.0f, -1.0f+y*2.0f, 0.0f, 1.0f);\n        v_position = vec2(x, y);\n    }",a=e.createShader(e.VERTEX_SHADER);e.shaderSource(a,r),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)||(console.log(e.getShaderInfoLog(a)),e.deleteShader(a));var o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(o,"#version 300 es\n    precision mediump float;\n\n    in vec2 v_position;\n    out vec4 color;\n\n    const float PI = 3.14159265359;\n\n\n    float VanDerCorpus(uint n, uint base)\n    {\n        float invBase = 1.0 / float(base);\n        float denom   = 1.0;\n        float result  = 0.0;\n\n        for(uint i = 0u; i < 32u; ++i)\n        {\n            if(n > 0u)\n            {\n                denom   = mod(float(n), 2.0);\n                result += denom * invBase;\n                invBase = invBase / 2.0;\n                n       = uint(float(n) / 2.0);\n            }\n        }\n\n        return result;\n    }\n    vec2 Hammersley(uint i, uint N)\n    {\n        return vec2(float(i)/float(N), VanDerCorpus(i, 2u));\n    }\n\n    vec3 ImportanceSampleGGX(vec2 Xi, vec3 N, float roughness)\n    {\n        float a = roughness*roughness;\n        \n        float phi = 2.0 * PI * Xi.x;\n        float cosTheta = sqrt((1.0 - Xi.y) / (1.0 + (a*a - 1.0) * Xi.y));\n        float sinTheta = sqrt(1.0 - cosTheta*cosTheta);\n        \n        // from spherical coordinates to cartesian coordinates\n        vec3 H;\n        H.x = cos(phi) * sinTheta;\n        H.y = sin(phi) * sinTheta;\n        H.z = cosTheta;\n        \n        // from tangent-space vector to world-space sample vector\n        vec3 up        = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n        vec3 tangent   = normalize(cross(up, N));\n        vec3 bitangent = cross(N, tangent);\n        \n        vec3 sampleVec = tangent * H.x + bitangent * H.y + N * H.z;\n        return normalize(sampleVec);\n    }  \n\n    float GeometrySchlickGGX(float NdotV, float roughness)\n{\n    float a = roughness;\n    float k = (a * a) / 2.0;\n\n    float nom   = NdotV;\n    float denom = NdotV * (1.0 - k) + k;\n\n    return nom / denom;\n}\n// ----------------------------------------------------------------------------\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness)\n{\n    float NdotV = max(dot(N, V), 0.0);\n    float NdotL = max(dot(N, L), 0.0);\n    float ggx2 = GeometrySchlickGGX(NdotV, roughness);\n    float ggx1 = GeometrySchlickGGX(NdotL, roughness);\n\n    return ggx1 * ggx2;\n} \n    vec2 IntegrateBRDF(float NdotV, float roughness)\n{\n    vec3 V;\n    V.x = sqrt(1.0 - NdotV*NdotV);\n    V.y = 0.0;\n    V.z = NdotV;\n\n    float A = 0.0;\n    float B = 0.0;\n\n    vec3 N = vec3(0.0, 0.0, 1.0);\n\n    const uint SAMPLE_COUNT = 1024u;\n    for(uint i = 0u; i < SAMPLE_COUNT; ++i)\n    {\n        vec2 Xi = Hammersley(i, SAMPLE_COUNT);\n        vec3 H  = ImportanceSampleGGX(Xi, N, roughness);\n        vec3 L  = normalize(2.0 * dot(V, H) * H - V);\n\n        float NdotL = max(L.z, 0.0);\n        float NdotH = max(H.z, 0.0);\n        float VdotH = max(dot(V, H), 0.0);\n\n        if(NdotL > 0.0)\n        {\n            float G = GeometrySmith(N, V, L, roughness);\n            float G_Vis = (G * VdotH) / (NdotH * NdotV);\n            float Fc = pow(1.0 - VdotH, 5.0);\n\n            A += (1.0 - Fc) * G_Vis;\n            B += Fc * G_Vis;\n        }\n    }\n    A /= float(SAMPLE_COUNT);\n    B /= float(SAMPLE_COUNT);\n    return vec2(A, B);\n}\n// ----------------------------------------------------------------------------\nvoid main() \n{\n    vec2 integratedBRDF = IntegrateBRDF(v_position.x, v_position.y);\n    color = vec4(integratedBRDF, 0.0, 1.0);\n}"),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)||(console.log(e.getShaderInfoLog(o)),e.deleteShader(o));var i=e.createProgram();e.attachShader(i,a),e.attachShader(i,o),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)||(console.log(e.getProgramInfoLog(i)),e.deleteProgram(i));var u=e.createFramebuffer();e.createRenderbuffer();e.bindFramebuffer(e.FRAMEBUFFER,u);var s=e.createTexture();return e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,e.RGB,512,512,0,e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.bindTexture(e.TEXTURE_2D,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0),e.bindFramebuffer(e.FRAMEBUFFER,u),e.viewport(0,0,512,512),e.bindVertexArray(n),e.useProgram(i),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.drawArrays(e.TRIANGLES,0,6),e.bindVertexArray(null),e.bindFramebuffer(e.FRAMEBUFFER,null),s}(e),t(h)}},s.src=u})});d.onload=_,t._loads.push(d.onload),t._environment=d}window.customElements.define("poly-wolf",class extends HTMLDivElement{constructor(){super(),this.style="\n            position:relative;\n            background-color:grey;\n        ",this.canvas=document.createElement("canvas"),this.appendChild(this.canvas),this.canvas.height=this.getAttribute("height"),this.canvas.width=this.getAttribute("width"),this.style.height=this.canvas.height,this.style.width=this.canvas.width,this.canvas.style="\n            position:absolute;\n            opacity:0.9;\n        ",this.gl=this.canvas.getContext("webgl2"),this.url=this.getAttribute("url"),this.button=document.createElement("div"),this.button.innerHTML='\n        <img src="https://img.icons8.com/nolan/64/000000/play.png">\n        ',this.button.style="\n            margin: 0;\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            color:black;\n        ",this.appendChild(this.button),this.button.onclick=()=>{this.button.innerHTML="Loading",this.load()}}load(){Wt(this.gl,this.url).then(e=>{this.button.style.visibility="hidden",console.log(e),e._render()})}},{extends:"div"}),window.customElements.whenDefined("poly-wolf").then(()=>{console.log("poly wolf has been defined")})}]);