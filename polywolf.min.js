!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(t,n,r){var a;a=function(){function t(){var e,t,s=document.createElement("canvas"),u="t",c=1,l=2.2,f=null;return s.__defineGetter__("exposure",function(){return c}),s.__defineSetter__("exposure",function(n){c=n,f&&(i(f,c,l,t.data),e.putImageData(t,0,0))}),s.__defineGetter__("gamma",function(){return l}),s.__defineSetter__("gamma",function(n){l=n,f&&(i(f,c,l,t.data),e.putImageData(t,0,0))}),s.__defineGetter__("dataFloat",function(){return o(f)}),s.__defineGetter__("dataRGBE",function(){return f}),s.toHDRBlob=function(e,t,r){function a(e,t,n){var r=e.createShader(n);return e.shaderSource(r,t),e.compileShader(r),r}var i=t&&t.match(/rgb9_e5/i)?new Uint8Array(n(o(f)).buffer):new Uint8Array(f.buffer),s=this.width,u=this.height;if(s*u*4<i.byteLength)return console.error("not big enough.");var c=document.createElement("canvas");c.width=s,c.height=u;var l=c.getContext("webgl",{antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),m=l.createTexture();l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,m),l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!0),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,s,u,0,l.RGBA,l.UNSIGNED_BYTE,new Uint8Array(i.buffer));var h=function(e,t,n){var r,o,i=e.createProgram();return e.attachShader(i,r=a(e,t,e.VERTEX_SHADER)),e.attachShader(i,o=a(e,n,e.FRAGMENT_SHADER)),e.linkProgram(i),e.deleteShader(r),e.deleteShader(o),i}(l,"precision highp float;\nattribute vec3 position;\nvarying vec2 tex;\nvoid main() { tex = position.xy/2.0+0.5; gl_Position = vec4(position, 1.0); }","precision highp float;\nprecision highp sampler2D;\nuniform sampler2D tx;\nvarying vec2 tex;\nvoid main() { gl_FragColor = texture2D(tx,tex); }"),d=l.getUniformLocation(h,"tx"),_=new Float32Array([-1,-1,0,1,-1,0,1,1,0,1,1,0,-1,1,0,-1,-1,0]),p=l.createBuffer();return l.enableVertexAttribArray(0),l.bindBuffer(l.ARRAY_BUFFER,p),l.bufferData(l.ARRAY_BUFFER,_,l.STATIC_DRAW),l.vertexAttribPointer(0,3,l.FLOAT,!1,0,0),l.useProgram(h),l.uniform1i(d,0),l.drawArrays(l.TRIANGLES,0,6),l.deleteTexture(m),l.deleteProgram(h),e?c.toBlob(e):void 0},s.__defineGetter__("src",function(){return u}),s.__defineSetter__("src",function(n){if(u=n,e&&e.clearRect(0,0,this.width,this.height),n.match(/\.hdr$/i))m=n,h=function(n,r,a){f=n,this.width=this.style.width=r,this.height=this.style.height=a,e=this.getContext("2d"),t=e.getImageData(0,0,r,a),i(n,c,l,t.data),e.putImageData(t,0,0),this.onload&&this.onload()}.bind(s),(d=function(e,t){for(var n in t)e[n]=t[n];return e}(new XMLHttpRequest,{responseType:"arraybuffer"})).onerror=h.bind(d,!1),d.onload=function(){if(this.status>=400)return this.onerror();for(var e,t="",n=0,r=new Uint8Array(this.response);!t.match(/\n\n[^\n]+\n/g);)t+=String.fromCharCode(r[n++]);if("32-bit_rle_rgbe"!=(e=t.match(/FORMAT=(.*)$/m)[1]))return console.warn("unknown format : "+e),this.onerror();for(var a=t.split(/\n/).reverse()[1].split(" "),o=1*a[3],i=1*a[1],s=new Uint8Array(o*i*4),u=0,c=0;c<i;c++){var l=r.slice(n,n+=4),f=[];if(2!=l[0]||2!=l[1]||128&l[2])return console.warn("HDR parse error .."),this.onerror();if((l[2]<<8)+l[3]!=o)return console.warn("HDR line mismatch .."),this.onerror();for(var m=0;m<4;m++)for(var d,_,p=m*o,E=(m+1)*o;p<E;)if((d=r.slice(n,n+=2))[0]>128)for(_=d[0]-128;_-- >0;)f[p++]=d[1];else for(_=d[0]-1,f[p++]=d[1];_-- >0;)f[p++]=r[n++];for(m=0;m<o;m++)s[u++]=f[m],s[u++]=f[m+o],s[u++]=f[m+2*o],s[u++]=f[m+3*o]}h&&h(s,o,i)},d.open("GET",m,!0),d.send(null);else if(n.match(/\.rgb9_e5\.png$/i)){(o=new Image).src=n,o.onload=function(){var n=document.createElement("canvas"),s=this.width=this.style.width=n.width=o.width,u=this.height=this.style.height=n.height=o.height,m=n.getContext("webgl"),h=m.createTexture();m.bindTexture(m.TEXTURE_2D,h),m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,o),fb=m.createFramebuffer(),m.bindFramebuffer(m.FRAMEBUFFER,fb),m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,h,0);var d=new Uint8Array(s*u*4);m.readPixels(0,0,s,u,m.RGBA,m.UNSIGNED_BYTE,d),m.deleteTexture(h),m.deleteFramebuffer(fb),this.dataRAW=new Uint32Array(d.buffer),f=a(r(this.dataRAW)),e=this.getContext("2d"),t=e.getImageData(0,0,s,u),i(f,c,l,t.data),e.putImageData(t,0,0),this.onload&&this.onload()}.bind(s)}else if(n.match(/\.hdr\.png$|\.rgbe\.png/i)){var o;(o=new Image).src=n,o.onload=function(){var n=document.createElement("canvas"),r=this.width=this.style.width=n.width=o.width,a=this.height=this.style.height=n.height=o.height,s=n.getContext("webgl"),u=s.createTexture();s.bindTexture(s.TEXTURE_2D,u),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,o),fb=s.createFramebuffer(),s.bindFramebuffer(s.FRAMEBUFFER,fb),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,u,0);var m=new Uint8Array(r*a*4);s.readPixels(0,0,r,a,s.RGBA,s.UNSIGNED_BYTE,m),s.deleteTexture(u),s.deleteFramebuffer(fb),f=m,e=this.getContext("2d"),t=e.getImageData(0,0,r,a),i(f,c,l,t.data),e.putImageData(t,0,0),this.onload&&this.onload()}.bind(s)}var m,h,d}),s}function n(e,t){for(var n,r,a,o,i,s,u=e.byteLength/12|0,c=(t=t||new Uint32Array(u),0);c<u;c++)n=Math.min(32768,e[3*c]),r=Math.min(32768,e[3*c+1]),a=Math.min(32768,e[3*c+2]),o=Math.max(Math.max(n,r),a),i=Math.max(-16,Math.floor(Math.log2(o)))+16,s=Math.pow(2,i-24),511==Math.floor(o/s+.5)&&(s*=2,i+=1),t[c]=(Math.floor(n/s+.5)<<23)+(Math.floor(r/s+.5)<<14)+(Math.floor(a/s+.5)<<5)+(0|i);return t}function r(e,t){for(var n,r,a=e.byteLength>>2,o=(t=t||new Float32Array(3*a),0);o<a;o++)n=e[o],r=Math.pow(2,(31&n)-24),t[3*o]=(n>>>23)*r,t[3*o+1]=(n>>>14&511)*r,t[3*o+2]=(n>>>5&511)*r;return t}function a(t,n){for(var r,a,o,i,s,u=t.byteLength/12|0,c=(n=n||new Uint8Array(4*u),0);c<u;c++)r=t[3*c],a=t[3*c+1],o=t[3*c+2],i=Math.max(Math.max(r,a),o),e=Math.ceil(Math.log2(i)),s=Math.pow(2,e-8),n[4*c]=r/s|0,n[4*c+1]=a/s|0,n[4*c+2]=o/s|0,n[4*c+3]=e+128;return n}function o(e,t){for(var n,r=e.byteLength>>2,a=(t=t||new Float32Array(3*r),0);a<r;a++)n=Math.pow(2,e[4*a+3]-136),t[3*a]=e[4*a]*n,t[3*a+1]=e[4*a+1]*n,t[3*a+2]=e[4*a+2]*n;return t}function i(e,t,n,r){t=Math.pow(2,void 0===t?1:t)/2,void 0===n&&(n=2.2);for(var a,o=1/n,i=e.byteLength>>2,s=(r=r||new Uint8ClampedArray(4*i),0);s<i;s++)a=t*Math.pow(2,e[4*s+3]-136),r[4*s]=255*Math.pow(e[4*s]*a,o),r[4*s+1]=255*Math.pow(e[4*s+1]*a,o),r[4*s+2]=255*Math.pow(e[4*s+2]*a,o),r[4*s+3]=255;return r}return t.floatToRgbe=a,t.rgbeToFloat=o,t.floatToRgb9_e5=n,t.rgb9_e5ToFloat=r,t.rgbeToLDR=i,t.floatToLDR=function(e,t,n,r){t=Math.pow(2,void 0===t?1:t)/2,void 0===n&&(n=2.2);for(var a=1/n,o=e.byteLength/12|0,i=(r=r||new Uint8ClampedArray(4*o),0);i<o;i++)r[4*i]=255*Math.pow(e[3*i]*t,a),r[4*i+1]=255*Math.pow(e[3*i+1]*t,a),r[4*i+2]=255*Math.pow(e[3*i+2]*t,a),r[4*i+3]=255;return r},t},t.exports?t.exports=a():r(1)("HDRImage",a)},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"create",function(){return f}),n.d(r,"clone",function(){return m}),n.d(r,"copy",function(){return h}),n.d(r,"fromValues",function(){return d}),n.d(r,"set",function(){return _}),n.d(r,"identity",function(){return p}),n.d(r,"transpose",function(){return E}),n.d(r,"invert",function(){return v}),n.d(r,"adjoint",function(){return T}),n.d(r,"determinant",function(){return g}),n.d(r,"multiply",function(){return M}),n.d(r,"translate",function(){return x}),n.d(r,"scale",function(){return b}),n.d(r,"rotate",function(){return R}),n.d(r,"rotateX",function(){return A}),n.d(r,"rotateY",function(){return U}),n.d(r,"rotateZ",function(){return y}),n.d(r,"fromTranslation",function(){return P}),n.d(r,"fromScaling",function(){return S}),n.d(r,"fromRotation",function(){return w}),n.d(r,"fromXRotation",function(){return F}),n.d(r,"fromYRotation",function(){return L}),n.d(r,"fromZRotation",function(){return I}),n.d(r,"fromRotationTranslation",function(){return N}),n.d(r,"fromQuat2",function(){return X}),n.d(r,"getTranslation",function(){return B}),n.d(r,"getScaling",function(){return D}),n.d(r,"getRotation",function(){return C}),n.d(r,"fromRotationTranslationScale",function(){return V}),n.d(r,"fromRotationTranslationScaleOrigin",function(){return O}),n.d(r,"fromQuat",function(){return G}),n.d(r,"frustum",function(){return k}),n.d(r,"perspective",function(){return H}),n.d(r,"perspectiveFromFieldOfView",function(){return z}),n.d(r,"ortho",function(){return q}),n.d(r,"lookAt",function(){return Y}),n.d(r,"targetTo",function(){return W}),n.d(r,"str",function(){return j}),n.d(r,"frob",function(){return J}),n.d(r,"add",function(){return K}),n.d(r,"subtract",function(){return Z}),n.d(r,"multiplyScalar",function(){return Q}),n.d(r,"multiplyScalarAndAdd",function(){return $}),n.d(r,"exactEquals",function(){return ee}),n.d(r,"equals",function(){return te}),n.d(r,"mul",function(){return ne}),n.d(r,"sub",function(){return re});var a={};n.r(a),n.d(a,"create",function(){return ae}),n.d(a,"clone",function(){return oe}),n.d(a,"length",function(){return ie}),n.d(a,"fromValues",function(){return se}),n.d(a,"copy",function(){return ue}),n.d(a,"set",function(){return ce}),n.d(a,"add",function(){return le}),n.d(a,"subtract",function(){return fe}),n.d(a,"multiply",function(){return me}),n.d(a,"divide",function(){return he}),n.d(a,"ceil",function(){return de}),n.d(a,"floor",function(){return _e}),n.d(a,"min",function(){return pe}),n.d(a,"max",function(){return Ee}),n.d(a,"round",function(){return ve}),n.d(a,"scale",function(){return Te}),n.d(a,"scaleAndAdd",function(){return ge}),n.d(a,"distance",function(){return Me}),n.d(a,"squaredDistance",function(){return xe}),n.d(a,"squaredLength",function(){return be}),n.d(a,"negate",function(){return Re}),n.d(a,"inverse",function(){return Ae}),n.d(a,"normalize",function(){return Ue}),n.d(a,"dot",function(){return ye}),n.d(a,"cross",function(){return Pe}),n.d(a,"lerp",function(){return Se}),n.d(a,"hermite",function(){return we}),n.d(a,"bezier",function(){return Fe}),n.d(a,"random",function(){return Le}),n.d(a,"transformMat4",function(){return Ie}),n.d(a,"transformMat3",function(){return Ne}),n.d(a,"transformQuat",function(){return Xe}),n.d(a,"rotateX",function(){return Be}),n.d(a,"rotateY",function(){return De}),n.d(a,"rotateZ",function(){return Ce}),n.d(a,"angle",function(){return Ve}),n.d(a,"zero",function(){return Oe}),n.d(a,"str",function(){return Ge}),n.d(a,"exactEquals",function(){return ke}),n.d(a,"equals",function(){return He}),n.d(a,"sub",function(){return ze}),n.d(a,"mul",function(){return qe}),n.d(a,"div",function(){return Ye}),n.d(a,"dist",function(){return We}),n.d(a,"sqrDist",function(){return je}),n.d(a,"len",function(){return Je}),n.d(a,"sqrLen",function(){return Ke}),n.d(a,"forEach",function(){return Ze});var o={};n.r(o),n.d(o,"create",function(){return et}),n.d(o,"identity",function(){return tt}),n.d(o,"setAxisAngle",function(){return nt}),n.d(o,"getAxisAngle",function(){return rt}),n.d(o,"multiply",function(){return at}),n.d(o,"rotateX",function(){return ot}),n.d(o,"rotateY",function(){return it}),n.d(o,"rotateZ",function(){return st}),n.d(o,"calculateW",function(){return ut}),n.d(o,"slerp",function(){return ct}),n.d(o,"random",function(){return lt}),n.d(o,"invert",function(){return ft}),n.d(o,"conjugate",function(){return mt}),n.d(o,"fromMat3",function(){return ht}),n.d(o,"fromEuler",function(){return dt}),n.d(o,"str",function(){return _t}),n.d(o,"clone",function(){return pt}),n.d(o,"fromValues",function(){return Et}),n.d(o,"copy",function(){return vt}),n.d(o,"set",function(){return Tt}),n.d(o,"add",function(){return gt}),n.d(o,"mul",function(){return Mt}),n.d(o,"scale",function(){return xt}),n.d(o,"dot",function(){return bt}),n.d(o,"lerp",function(){return Rt}),n.d(o,"length",function(){return At}),n.d(o,"len",function(){return Ut}),n.d(o,"squaredLength",function(){return yt}),n.d(o,"sqrLen",function(){return Pt}),n.d(o,"normalize",function(){return St}),n.d(o,"exactEquals",function(){return wt}),n.d(o,"equals",function(){return Ft}),n.d(o,"rotationTo",function(){return Lt}),n.d(o,"sqlerp",function(){return It}),n.d(o,"setAxes",function(){return Nt});const i=1e-6;let s="undefined"!=typeof Float32Array?Float32Array:Array;const u=Math.random;const c=Math.PI/180;function l(e){return e*c}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function f(){let e=new s(16);return s!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function m(e){let t=new s(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function h(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function d(e,t,n,r,a,o,i,u,c,l,f,m,h,d,_,p){let E=new s(16);return E[0]=e,E[1]=t,E[2]=n,E[3]=r,E[4]=a,E[5]=o,E[6]=i,E[7]=u,E[8]=c,E[9]=l,E[10]=f,E[11]=m,E[12]=h,E[13]=d,E[14]=_,E[15]=p,E}function _(e,t,n,r,a,o,i,s,u,c,l,f,m,h,d,_,p){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=o,e[5]=i,e[6]=s,e[7]=u,e[8]=c,e[9]=l,e[10]=f,e[11]=m,e[12]=h,e[13]=d,e[14]=_,e[15]=p,e}function p(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function E(e,t){if(e===t){let n=t[1],r=t[2],a=t[3],o=t[6],i=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=a,e[13]=i,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function v(e,t){let n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],m=t[10],h=t[11],d=t[12],_=t[13],p=t[14],E=t[15],v=n*s-r*i,T=n*u-a*i,g=n*c-o*i,M=r*u-a*s,x=r*c-o*s,b=a*c-o*u,R=l*_-f*d,A=l*p-m*d,U=l*E-h*d,y=f*p-m*_,P=f*E-h*_,S=m*E-h*p,w=v*S-T*P+g*y+M*U-x*A+b*R;return w?(w=1/w,e[0]=(s*S-u*P+c*y)*w,e[1]=(a*P-r*S-o*y)*w,e[2]=(_*b-p*x+E*M)*w,e[3]=(m*x-f*b-h*M)*w,e[4]=(u*U-i*S-c*A)*w,e[5]=(n*S-a*U+o*A)*w,e[6]=(p*g-d*b-E*T)*w,e[7]=(l*b-m*g+h*T)*w,e[8]=(i*P-s*U+c*R)*w,e[9]=(r*U-n*P-o*R)*w,e[10]=(d*x-_*g+E*v)*w,e[11]=(f*g-l*x-h*v)*w,e[12]=(s*A-i*y-u*R)*w,e[13]=(n*y-r*A+a*R)*w,e[14]=(_*T-d*M-p*v)*w,e[15]=(l*M-f*T+m*v)*w,e):null}function T(e,t){let n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],m=t[10],h=t[11],d=t[12],_=t[13],p=t[14],E=t[15];return e[0]=s*(m*E-h*p)-f*(u*E-c*p)+_*(u*h-c*m),e[1]=-(r*(m*E-h*p)-f*(a*E-o*p)+_*(a*h-o*m)),e[2]=r*(u*E-c*p)-s*(a*E-o*p)+_*(a*c-o*u),e[3]=-(r*(u*h-c*m)-s*(a*h-o*m)+f*(a*c-o*u)),e[4]=-(i*(m*E-h*p)-l*(u*E-c*p)+d*(u*h-c*m)),e[5]=n*(m*E-h*p)-l*(a*E-o*p)+d*(a*h-o*m),e[6]=-(n*(u*E-c*p)-i*(a*E-o*p)+d*(a*c-o*u)),e[7]=n*(u*h-c*m)-i*(a*h-o*m)+l*(a*c-o*u),e[8]=i*(f*E-h*_)-l*(s*E-c*_)+d*(s*h-c*f),e[9]=-(n*(f*E-h*_)-l*(r*E-o*_)+d*(r*h-o*f)),e[10]=n*(s*E-c*_)-i*(r*E-o*_)+d*(r*c-o*s),e[11]=-(n*(s*h-c*f)-i*(r*h-o*f)+l*(r*c-o*s)),e[12]=-(i*(f*p-m*_)-l*(s*p-u*_)+d*(s*m-u*f)),e[13]=n*(f*p-m*_)-l*(r*p-a*_)+d*(r*m-a*f),e[14]=-(n*(s*p-u*_)-i*(r*p-a*_)+d*(r*u-a*s)),e[15]=n*(s*m-u*f)-i*(r*m-a*f)+l*(r*u-a*s),e}function g(e){let t=e[0],n=e[1],r=e[2],a=e[3],o=e[4],i=e[5],s=e[6],u=e[7],c=e[8],l=e[9],f=e[10],m=e[11],h=e[12],d=e[13],_=e[14],p=e[15];return(t*i-n*o)*(f*p-m*_)-(t*s-r*o)*(l*p-m*d)+(t*u-a*o)*(l*_-f*d)+(n*s-r*i)*(c*p-m*h)-(n*u-a*i)*(c*_-f*h)+(r*u-a*s)*(c*d-l*h)}function M(e,t,n){let r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],m=t[9],h=t[10],d=t[11],_=t[12],p=t[13],E=t[14],v=t[15],T=n[0],g=n[1],M=n[2],x=n[3];return e[0]=T*r+g*s+M*f+x*_,e[1]=T*a+g*u+M*m+x*p,e[2]=T*o+g*c+M*h+x*E,e[3]=T*i+g*l+M*d+x*v,T=n[4],g=n[5],M=n[6],x=n[7],e[4]=T*r+g*s+M*f+x*_,e[5]=T*a+g*u+M*m+x*p,e[6]=T*o+g*c+M*h+x*E,e[7]=T*i+g*l+M*d+x*v,T=n[8],g=n[9],M=n[10],x=n[11],e[8]=T*r+g*s+M*f+x*_,e[9]=T*a+g*u+M*m+x*p,e[10]=T*o+g*c+M*h+x*E,e[11]=T*i+g*l+M*d+x*v,T=n[12],g=n[13],M=n[14],x=n[15],e[12]=T*r+g*s+M*f+x*_,e[13]=T*a+g*u+M*m+x*p,e[14]=T*o+g*c+M*h+x*E,e[15]=T*i+g*l+M*d+x*v,e}function x(e,t,n){let r,a,o,i,s,u,c,l,f,m,h,d,_=n[0],p=n[1],E=n[2];return t===e?(e[12]=t[0]*_+t[4]*p+t[8]*E+t[12],e[13]=t[1]*_+t[5]*p+t[9]*E+t[13],e[14]=t[2]*_+t[6]*p+t[10]*E+t[14],e[15]=t[3]*_+t[7]*p+t[11]*E+t[15]):(r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],m=t[9],h=t[10],d=t[11],e[0]=r,e[1]=a,e[2]=o,e[3]=i,e[4]=s,e[5]=u,e[6]=c,e[7]=l,e[8]=f,e[9]=m,e[10]=h,e[11]=d,e[12]=r*_+s*p+f*E+t[12],e[13]=a*_+u*p+m*E+t[13],e[14]=o*_+c*p+h*E+t[14],e[15]=i*_+l*p+d*E+t[15]),e}function b(e,t,n){let r=n[0],a=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function R(e,t,n,r){let a,o,s,u,c,l,f,m,h,d,_,p,E,v,T,g,M,x,b,R,A,U,y,P,S=r[0],w=r[1],F=r[2],L=Math.hypot(S,w,F);return L<i?null:(S*=L=1/L,w*=L,F*=L,a=Math.sin(n),s=1-(o=Math.cos(n)),u=t[0],c=t[1],l=t[2],f=t[3],m=t[4],h=t[5],d=t[6],_=t[7],p=t[8],E=t[9],v=t[10],T=t[11],g=S*S*s+o,M=w*S*s+F*a,x=F*S*s-w*a,b=S*w*s-F*a,R=w*w*s+o,A=F*w*s+S*a,U=S*F*s+w*a,y=w*F*s-S*a,P=F*F*s+o,e[0]=u*g+m*M+p*x,e[1]=c*g+h*M+E*x,e[2]=l*g+d*M+v*x,e[3]=f*g+_*M+T*x,e[4]=u*b+m*R+p*A,e[5]=c*b+h*R+E*A,e[6]=l*b+d*R+v*A,e[7]=f*b+_*R+T*A,e[8]=u*U+m*y+p*P,e[9]=c*U+h*y+E*P,e[10]=l*U+d*y+v*P,e[11]=f*U+_*y+T*P,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function A(e,t,n){let r=Math.sin(n),a=Math.cos(n),o=t[4],i=t[5],s=t[6],u=t[7],c=t[8],l=t[9],f=t[10],m=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*a+c*r,e[5]=i*a+l*r,e[6]=s*a+f*r,e[7]=u*a+m*r,e[8]=c*a-o*r,e[9]=l*a-i*r,e[10]=f*a-s*r,e[11]=m*a-u*r,e}function U(e,t,n){let r=Math.sin(n),a=Math.cos(n),o=t[0],i=t[1],s=t[2],u=t[3],c=t[8],l=t[9],f=t[10],m=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a-c*r,e[1]=i*a-l*r,e[2]=s*a-f*r,e[3]=u*a-m*r,e[8]=o*r+c*a,e[9]=i*r+l*a,e[10]=s*r+f*a,e[11]=u*r+m*a,e}function y(e,t,n){let r=Math.sin(n),a=Math.cos(n),o=t[0],i=t[1],s=t[2],u=t[3],c=t[4],l=t[5],f=t[6],m=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a+c*r,e[1]=i*a+l*r,e[2]=s*a+f*r,e[3]=u*a+m*r,e[4]=c*a-o*r,e[5]=l*a-i*r,e[6]=f*a-s*r,e[7]=m*a-u*r,e}function P(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function S(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function w(e,t,n){let r,a,o,s=n[0],u=n[1],c=n[2],l=Math.hypot(s,u,c);return l<i?null:(s*=l=1/l,u*=l,c*=l,r=Math.sin(t),o=1-(a=Math.cos(t)),e[0]=s*s*o+a,e[1]=u*s*o+c*r,e[2]=c*s*o-u*r,e[3]=0,e[4]=s*u*o-c*r,e[5]=u*u*o+a,e[6]=c*u*o+s*r,e[7]=0,e[8]=s*c*o+u*r,e[9]=u*c*o-s*r,e[10]=c*c*o+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function F(e,t){let n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function L(e,t){let n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function I(e,t){let n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function N(e,t,n){let r=t[0],a=t[1],o=t[2],i=t[3],s=r+r,u=a+a,c=o+o,l=r*s,f=r*u,m=r*c,h=a*u,d=a*c,_=o*c,p=i*s,E=i*u,v=i*c;return e[0]=1-(h+_),e[1]=f+v,e[2]=m-E,e[3]=0,e[4]=f-v,e[5]=1-(l+_),e[6]=d+p,e[7]=0,e[8]=m+E,e[9]=d-p,e[10]=1-(l+h),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function X(e,t){let n=new s(3),r=-t[0],a=-t[1],o=-t[2],i=t[3],u=t[4],c=t[5],l=t[6],f=t[7],m=r*r+a*a+o*o+i*i;return m>0?(n[0]=2*(u*i+f*r+c*o-l*a)/m,n[1]=2*(c*i+f*a+l*r-u*o)/m,n[2]=2*(l*i+f*o+u*a-c*r)/m):(n[0]=2*(u*i+f*r+c*o-l*a),n[1]=2*(c*i+f*a+l*r-u*o),n[2]=2*(l*i+f*o+u*a-c*r)),N(e,t,n),e}function B(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function D(e,t){let n=t[0],r=t[1],a=t[2],o=t[4],i=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.hypot(n,r,a),e[1]=Math.hypot(o,i,s),e[2]=Math.hypot(u,c,l),e}function C(e,t){let n=new s(3);D(n,t);let r=1/n[0],a=1/n[1],o=1/n[2],i=t[0]*r,u=t[1]*a,c=t[2]*o,l=t[4]*r,f=t[5]*a,m=t[6]*o,h=t[8]*r,d=t[9]*a,_=t[10]*o,p=i+f+_,E=0;return p>0?(E=2*Math.sqrt(p+1),e[3]=.25*E,e[0]=(m-d)/E,e[1]=(h-c)/E,e[2]=(u-l)/E):i>f&&i>_?(E=2*Math.sqrt(1+i-f-_),e[3]=(m-d)/E,e[0]=.25*E,e[1]=(u+l)/E,e[2]=(h+c)/E):f>_?(E=2*Math.sqrt(1+f-i-_),e[3]=(h-c)/E,e[0]=(u+l)/E,e[1]=.25*E,e[2]=(m+d)/E):(E=2*Math.sqrt(1+_-i-f),e[3]=(u-l)/E,e[0]=(h+c)/E,e[1]=(m+d)/E,e[2]=.25*E),e}function V(e,t,n,r){let a=t[0],o=t[1],i=t[2],s=t[3],u=a+a,c=o+o,l=i+i,f=a*u,m=a*c,h=a*l,d=o*c,_=o*l,p=i*l,E=s*u,v=s*c,T=s*l,g=r[0],M=r[1],x=r[2];return e[0]=(1-(d+p))*g,e[1]=(m+T)*g,e[2]=(h-v)*g,e[3]=0,e[4]=(m-T)*M,e[5]=(1-(f+p))*M,e[6]=(_+E)*M,e[7]=0,e[8]=(h+v)*x,e[9]=(_-E)*x,e[10]=(1-(f+d))*x,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function O(e,t,n,r,a){let o=t[0],i=t[1],s=t[2],u=t[3],c=o+o,l=i+i,f=s+s,m=o*c,h=o*l,d=o*f,_=i*l,p=i*f,E=s*f,v=u*c,T=u*l,g=u*f,M=r[0],x=r[1],b=r[2],R=a[0],A=a[1],U=a[2],y=(1-(_+E))*M,P=(h+g)*M,S=(d-T)*M,w=(h-g)*x,F=(1-(m+E))*x,L=(p+v)*x,I=(d+T)*b,N=(p-v)*b,X=(1-(m+_))*b;return e[0]=y,e[1]=P,e[2]=S,e[3]=0,e[4]=w,e[5]=F,e[6]=L,e[7]=0,e[8]=I,e[9]=N,e[10]=X,e[11]=0,e[12]=n[0]+R-(y*R+w*A+I*U),e[13]=n[1]+A-(P*R+F*A+N*U),e[14]=n[2]+U-(S*R+L*A+X*U),e[15]=1,e}function G(e,t){let n=t[0],r=t[1],a=t[2],o=t[3],i=n+n,s=r+r,u=a+a,c=n*i,l=r*i,f=r*s,m=a*i,h=a*s,d=a*u,_=o*i,p=o*s,E=o*u;return e[0]=1-f-d,e[1]=l+E,e[2]=m-p,e[3]=0,e[4]=l-E,e[5]=1-c-d,e[6]=h+_,e[7]=0,e[8]=m+p,e[9]=h-_,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function k(e,t,n,r,a,o,i){let s=1/(n-t),u=1/(a-r),c=1/(o-i);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(a+r)*u,e[10]=(i+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=i*o*2*c,e[15]=0,e}function H(e,t,n,r,a){let o,i=1/Math.tan(t/2);return e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(o=1/(r-a),e[10]=(a+r)*o,e[14]=2*a*r*o):(e[10]=-1,e[14]=-2*r),e}function z(e,t,n,r){let a=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),i=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(i+s),c=2/(a+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(i-s)*u*.5,e[9]=(a-o)*c*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function q(e,t,n,r,a,o,i){let s=1/(t-n),u=1/(r-a),c=1/(o-i);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(a+r)*u,e[14]=(i+o)*c,e[15]=1,e}function Y(e,t,n,r){let a,o,s,u,c,l,f,m,h,d,_=t[0],E=t[1],v=t[2],T=r[0],g=r[1],M=r[2],x=n[0],b=n[1],R=n[2];return Math.abs(_-x)<i&&Math.abs(E-b)<i&&Math.abs(v-R)<i?p(e):(f=_-x,m=E-b,h=v-R,a=g*(h*=d=1/Math.hypot(f,m,h))-M*(m*=d),o=M*(f*=d)-T*h,s=T*m-g*f,(d=Math.hypot(a,o,s))?(a*=d=1/d,o*=d,s*=d):(a=0,o=0,s=0),u=m*s-h*o,c=h*a-f*s,l=f*o-m*a,(d=Math.hypot(u,c,l))?(u*=d=1/d,c*=d,l*=d):(u=0,c=0,l=0),e[0]=a,e[1]=u,e[2]=f,e[3]=0,e[4]=o,e[5]=c,e[6]=m,e[7]=0,e[8]=s,e[9]=l,e[10]=h,e[11]=0,e[12]=-(a*_+o*E+s*v),e[13]=-(u*_+c*E+l*v),e[14]=-(f*_+m*E+h*v),e[15]=1,e)}function W(e,t,n,r){let a=t[0],o=t[1],i=t[2],s=r[0],u=r[1],c=r[2],l=a-n[0],f=o-n[1],m=i-n[2],h=l*l+f*f+m*m;h>0&&(l*=h=1/Math.sqrt(h),f*=h,m*=h);let d=u*m-c*f,_=c*l-s*m,p=s*f-u*l;return(h=d*d+_*_+p*p)>0&&(d*=h=1/Math.sqrt(h),_*=h,p*=h),e[0]=d,e[1]=_,e[2]=p,e[3]=0,e[4]=f*p-m*_,e[5]=m*d-l*p,e[6]=l*_-f*d,e[7]=0,e[8]=l,e[9]=f,e[10]=m,e[11]=0,e[12]=a,e[13]=o,e[14]=i,e[15]=1,e}function j(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function J(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function K(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function Z(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function Q(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function $(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function ee(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function te(e,t){let n=e[0],r=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],m=e[9],h=e[10],d=e[11],_=e[12],p=e[13],E=e[14],v=e[15],T=t[0],g=t[1],M=t[2],x=t[3],b=t[4],R=t[5],A=t[6],U=t[7],y=t[8],P=t[9],S=t[10],w=t[11],F=t[12],L=t[13],I=t[14],N=t[15];return Math.abs(n-T)<=i*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(r-g)<=i*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(a-M)<=i*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(o-x)<=i*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-b)<=i*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(u-R)<=i*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(c-A)<=i*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(l-U)<=i*Math.max(1,Math.abs(l),Math.abs(U))&&Math.abs(f-y)<=i*Math.max(1,Math.abs(f),Math.abs(y))&&Math.abs(m-P)<=i*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(h-S)<=i*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(d-w)<=i*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(_-F)<=i*Math.max(1,Math.abs(_),Math.abs(F))&&Math.abs(p-L)<=i*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(E-I)<=i*Math.max(1,Math.abs(E),Math.abs(I))&&Math.abs(v-N)<=i*Math.max(1,Math.abs(v),Math.abs(N))}const ne=M,re=Z;function ae(){let e=new s(3);return s!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function oe(e){var t=new s(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ie(e){let t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function se(e,t,n){let r=new s(3);return r[0]=e,r[1]=t,r[2]=n,r}function ue(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ce(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function le(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function fe(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function me(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function he(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function de(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function _e(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function pe(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function Ee(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function ve(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Te(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function ge(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function Me(e,t){let n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return Math.hypot(n,r,a)}function xe(e,t){let n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return n*n+r*r+a*a}function be(e){let t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function Re(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Ae(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Ue(e,t){let n=t[0],r=t[1],a=t[2],o=n*n+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function ye(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Pe(e,t,n){let r=t[0],a=t[1],o=t[2],i=n[0],s=n[1],u=n[2];return e[0]=a*u-o*s,e[1]=o*i-r*u,e[2]=r*s-a*i,e}function Se(e,t,n,r){let a=t[0],o=t[1],i=t[2];return e[0]=a+r*(n[0]-a),e[1]=o+r*(n[1]-o),e[2]=i+r*(n[2]-i),e}function we(e,t,n,r,a,o){let i=o*o,s=i*(2*o-3)+1,u=i*(o-2)+o,c=i*(o-1),l=i*(3-2*o);return e[0]=t[0]*s+n[0]*u+r[0]*c+a[0]*l,e[1]=t[1]*s+n[1]*u+r[1]*c+a[1]*l,e[2]=t[2]*s+n[2]*u+r[2]*c+a[2]*l,e}function Fe(e,t,n,r,a,o){let i=1-o,s=i*i,u=o*o,c=s*i,l=3*o*s,f=3*u*i,m=u*o;return e[0]=t[0]*c+n[0]*l+r[0]*f+a[0]*m,e[1]=t[1]*c+n[1]*l+r[1]*f+a[1]*m,e[2]=t[2]*c+n[2]*l+r[2]*f+a[2]*m,e}function Le(e,t){t=t||1;let n=2*u()*Math.PI,r=2*u()-1,a=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=r*t,e}function Ie(e,t,n){let r=t[0],a=t[1],o=t[2],i=n[3]*r+n[7]*a+n[11]*o+n[15];return i=i||1,e[0]=(n[0]*r+n[4]*a+n[8]*o+n[12])/i,e[1]=(n[1]*r+n[5]*a+n[9]*o+n[13])/i,e[2]=(n[2]*r+n[6]*a+n[10]*o+n[14])/i,e}function Ne(e,t,n){let r=t[0],a=t[1],o=t[2];return e[0]=r*n[0]+a*n[3]+o*n[6],e[1]=r*n[1]+a*n[4]+o*n[7],e[2]=r*n[2]+a*n[5]+o*n[8],e}function Xe(e,t,n){let r=n[0],a=n[1],o=n[2],i=n[3],s=t[0],u=t[1],c=t[2],l=a*c-o*u,f=o*s-r*c,m=r*u-a*s,h=a*m-o*f,d=o*l-r*m,_=r*f-a*l,p=2*i;return l*=p,f*=p,m*=p,h*=2,d*=2,_*=2,e[0]=s+l+h,e[1]=u+f+d,e[2]=c+m+_,e}function Be(e,t,n,r){let a=[],o=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],o[0]=a[0],o[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),o[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function De(e,t,n,r){let a=[],o=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],o[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),o[1]=a[1],o[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function Ce(e,t,n,r){let a=[],o=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],o[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),o[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),o[2]=a[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function Ve(e,t){let n=se(e[0],e[1],e[2]),r=se(t[0],t[1],t[2]);Ue(n,n),Ue(r,r);let a=ye(n,r);return a>1?0:a<-1?Math.PI:Math.acos(a)}function Oe(e){return e[0]=0,e[1]=0,e[2]=0,e}function Ge(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function ke(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function He(e,t){let n=e[0],r=e[1],a=e[2],o=t[0],s=t[1],u=t[2];return Math.abs(n-o)<=i*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=i*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-u)<=i*Math.max(1,Math.abs(a),Math.abs(u))}const ze=fe,qe=me,Ye=he,We=Me,je=xe,Je=ie,Ke=be,Ze=function(){let e=ae();return function(t,n,r,a,o,i){let s,u;for(n||(n=3),r||(r=0),u=a?Math.min(a*n+r,t.length):t.length,s=r;s<u;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],o(e,e,i),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}();function Qe(e){let t=e[0],n=e[1],r=e[2],a=e[3];return Math.hypot(t,n,r,a)}function $e(e){let t=e[0],n=e[1],r=e[2],a=e[3];return t*t+n*n+r*r+a*a}!function(){let e=function(){let e=new s(4);return s!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}();function et(){let e=new s(4);return s!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function tt(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function nt(e,t,n){n*=.5;let r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function rt(e,t){let n=2*Math.acos(t[3]),r=Math.sin(n/2);return r>i?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function at(e,t,n){let r=t[0],a=t[1],o=t[2],i=t[3],s=n[0],u=n[1],c=n[2],l=n[3];return e[0]=r*l+i*s+a*c-o*u,e[1]=a*l+i*u+o*s-r*c,e[2]=o*l+i*c+r*u-a*s,e[3]=i*l-r*s-a*u-o*c,e}function ot(e,t,n){n*=.5;let r=t[0],a=t[1],o=t[2],i=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+i*s,e[1]=a*u+o*s,e[2]=o*u-a*s,e[3]=i*u-r*s,e}function it(e,t,n){n*=.5;let r=t[0],a=t[1],o=t[2],i=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u-o*s,e[1]=a*u+i*s,e[2]=o*u+r*s,e[3]=i*u-a*s,e}function st(e,t,n){n*=.5;let r=t[0],a=t[1],o=t[2],i=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+a*s,e[1]=a*u-r*s,e[2]=o*u+i*s,e[3]=i*u-o*s,e}function ut(e,t){let n=t[0],r=t[1],a=t[2];return e[0]=n,e[1]=r,e[2]=a,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-a*a)),e}function ct(e,t,n,r){let a,o,s,u,c,l=t[0],f=t[1],m=t[2],h=t[3],d=n[0],_=n[1],p=n[2],E=n[3];return(o=l*d+f*_+m*p+h*E)<0&&(o=-o,d=-d,_=-_,p=-p,E=-E),1-o>i?(a=Math.acos(o),s=Math.sin(a),u=Math.sin((1-r)*a)/s,c=Math.sin(r*a)/s):(u=1-r,c=r),e[0]=u*l+c*d,e[1]=u*f+c*_,e[2]=u*m+c*p,e[3]=u*h+c*E,e}function lt(e){let t=u(),n=u(),r=u(),a=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*n),e[1]=a*Math.cos(2*Math.PI*n),e[2]=o*Math.sin(2*Math.PI*r),e[3]=o*Math.cos(2*Math.PI*r),e}function ft(e,t){let n=t[0],r=t[1],a=t[2],o=t[3],i=n*n+r*r+a*a+o*o,s=i?1/i:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-a*s,e[3]=o*s,e}function mt(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function ht(e,t){let n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);let a=(r+1)%3,o=(r+2)%3;n=Math.sqrt(t[3*r+r]-t[3*a+a]-t[3*o+o]+1),e[r]=.5*n,n=.5/n,e[3]=(t[3*a+o]-t[3*o+a])*n,e[a]=(t[3*a+r]+t[3*r+a])*n,e[o]=(t[3*o+r]+t[3*r+o])*n}return e}function dt(e,t,n,r){let a=.5*Math.PI/180;t*=a,n*=a,r*=a;let o=Math.sin(t),i=Math.cos(t),s=Math.sin(n),u=Math.cos(n),c=Math.sin(r),l=Math.cos(r);return e[0]=o*u*l-i*s*c,e[1]=i*s*l+o*u*c,e[2]=i*u*c-o*s*l,e[3]=i*u*l+o*s*c,e}function _t(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const pt=function(e){let t=new s(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Et=function(e,t,n,r){let a=new s(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=r,a},vt=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Tt=function(e,t,n,r,a){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e},gt=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},Mt=at,xt=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},bt=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Rt=function(e,t,n,r){let a=t[0],o=t[1],i=t[2],s=t[3];return e[0]=a+r*(n[0]-a),e[1]=o+r*(n[1]-o),e[2]=i+r*(n[2]-i),e[3]=s+r*(n[3]-s),e},At=Qe,Ut=At,yt=$e,Pt=yt,St=function(e,t){let n=t[0],r=t[1],a=t[2],o=t[3],i=n*n+r*r+a*a+o*o;return i>0&&(i=1/Math.sqrt(i)),e[0]=n*i,e[1]=r*i,e[2]=a*i,e[3]=o*i,e},wt=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Ft=function(e,t){let n=e[0],r=e[1],a=e[2],o=e[3],s=t[0],u=t[1],c=t[2],l=t[3];return Math.abs(n-s)<=i*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-u)<=i*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-c)<=i*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(o-l)<=i*Math.max(1,Math.abs(o),Math.abs(l))},Lt=function(){let e=ae(),t=se(1,0,0),n=se(0,1,0);return function(r,a,o){let i=ye(a,o);return i<-.999999?(Pe(e,t,a),Je(e)<1e-6&&Pe(e,n,a),Ue(e,e),nt(r,e,Math.PI),r):i>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Pe(e,a,o),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+i,St(r,r))}}(),It=function(){let e=et(),t=et();return function(n,r,a,o,i,s){return ct(e,r,i,s),ct(t,a,o,s),ct(n,e,t,2*s*(1-s)),n}}(),Nt=function(){let e=function(){let e=new s(9);return s!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}();return function(t,n,r,a){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=a[0],e[4]=a[1],e[7]=a[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],St(t,ht(t,e))}}();!function(){let e=function(){let e=new s(2);return s!=Float32Array&&(e[0]=0,e[1]=0),e}()}();const Xt={POSITION:0,NORMAL:1,TEXCOORD_0:2,COLOR_0:3,TANGENT:4,WEIGHTS_0:5,JOINTS_0:6},Bt={VEC2:2,VEC3:3,VEC4:4,SCALAR:1},Dt={view:"view",perspective:"perspective",env_map:"env_map",diffuse_map:"diffuse_map",prefilter_map:"prefilter_map",brdflut_map:"brdflut_map"},Ct={translation:3,rotation:4,scale:3,matrix:16};var Vt=n(0),Ot="",Gt="",kt="\nlayout( location = 0 ) in vec3 position;\n\nuniform mat4 perspective;\nuniform mat4 view;\nuniform mat4 model;\n\nvoid main(){\n    gl_Position = perspective*view*model*vec4(position, 1.0);\n}\n",Ht="\n    precision mediump float;\n    out vec4 color;\n    void main(){\n        color = vec4(1.0, 0.0, 0.0, 1.0);\n    }\n",zt="\nlayout( location = 0 ) in vec3 position;\nlayout( location = 1 ) in vec3 normal;\nlayout( location = 2 ) in vec2 texcoords;\n\nuniform mat4 perspective;\nuniform mat4 view;\nuniform mat4 model;\n\nout vec3 v_position;\nout vec3 v_normal;\nout vec2 v_texcoords;\n\nvoid main(){\n    gl_Position = perspective*view*model*vec4(position, 1.0);\n    v_position = (view*model*vec4(position, 1.0)).xyz;\n    v_normal = mat3(transpose(inverse(view*model))) * normal;\n    v_texcoords = texcoords;\n}\n",qt="\n#define NUM_LIGHTS 1\nprecision mediump float;\n\nin vec3 v_position;\nin vec3 v_normal;\nin vec2 v_texcoords;\n\nuniform sampler2D emissiveTexture;\nvec3 emissive;\n\nuniform sampler2D normalTexture;\n\nvec3 normal;\n\nuniform sampler2D occlusionTexture;\nfloat occlusion;\n\nuniform sampler2D baseColorTexture;\nvec4 base_color;\n\nuniform sampler2D metallicRoughnessTexture;\nfloat roughness;\nfloat metallic;\n\nuniform samplerCube env_map;\nuniform samplerCube diffuse_map;\nuniform samplerCube prefilter_map;\nuniform sampler2D brdflut_map;\n\n//light variables\nvec3 light_positions[1];\nvec3 light_colors[1];\n\nconst float PI = 3.14159265359;\n\n//set lights functions\nvoid set_lights(){\n  light_positions[0] = vec3(5);\n  light_colors[0] = vec3(10);\n}\n\n//length function \n/*float length(vec3 operand){\n  return sqrt((operand.x*operand.x)+(operand.y*operand.y)+(operand.z*operand.z));\n}*/\nout vec4 color;\n\n//pbr functions\nvec3 fresnelSchlick(float cosTheta, vec3 F0)\n{\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\n}  \n\nvec3 fresnelSchlickRoughness(float cosTheta, vec3 F0, float roughness)\n{\n  return F0 + (max(vec3(1.0 - roughness), F0) - F0) * pow(1.0 - cosTheta, 5.0);\n}  \n\nfloat DistributionGGX(vec3 N, vec3 H, float roughness)\n{\n    float a      = roughness*roughness;\n    float a2     = a*a;\n    float NdotH  = max(dot(N, H), 0.0);\n    float NdotH2 = NdotH*NdotH;\n\t\n    float num   = a2;\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\n    denom = PI * denom * denom;\n\t\n    return num / denom;\n}\n\nfloat GeometrySchlickGGX(float NdotV, float roughness)\n{\n    float r = (roughness + 1.0);\n    float k = (r*r) / 8.0;\n\n    float num   = NdotV;\n    float denom = NdotV * (1.0 - k) + k;\n\t\n    return num / denom;\n}\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness)\n{\n    float NdotV = max(dot(N, V), 0.0);\n    float NdotL = max(dot(N, L), 0.0);\n    float ggx2  = GeometrySchlickGGX(NdotV, roughness);\n    float ggx1  = GeometrySchlickGGX(NdotL, roughness);\n\t\n    return ggx1 * ggx2;\n}\n\nvec3 getNormal(){\n  vec3 pos_dx = dFdx(v_position);\n  vec3 pos_dy = dFdy(v_position);\n  vec3 tex_dx = dFdx(vec3(v_texcoords, 0.0));\n  vec3 tex_dy = dFdy(vec3(v_texcoords, 0.0));\n  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n\n  vec3 ng = v_normal;\n\n  t = normalize(t - ng * dot(ng, t));\n  vec3 b = normalize(cross(ng, t));\n  mat3 tbn = mat3(t, b, ng);\n\n  #ifdef NORMALTEXTURE\n  vec3 n = texture(normalTexture, v_texcoords).rgb;\n  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(1, 1, 1.0)));\n  #else\nvec3 n = tbn[2].xyz;\n#endif\n\n  return n;\n}\n \nvoid main() {\n  //set lights\n  set_lights();\n\n  //set material info\n  #ifdef BASECOLORTEXTURE\n  base_color = texture(baseColorTexture, v_texcoords);\n  #endif\n\n  normal = getNormal();\n\n  #ifdef METALLICROUGHNESSTEXTURE\n  metallic = texture(metallicRoughnessTexture, v_texcoords).b;\n  roughness = texture(metallicRoughnessTexture, v_texcoords).g;\n  #endif\n\n  #ifdef OCCLUSIONTEXTURE\n  occlusion = texture(occlusionTexture, v_texcoords).r;\n  #endif\n\n  #ifdef EMISSIVETEXTURE\n  emissive = texture(emissiveTexture, v_texcoords).rgb;\n  #endif\n\n  //set geometry info\n  vec3 n = normalize(normal);\n  vec3 v = normalize(-v_position);\n  vec3 R = -normalize(reflect(v, n));   \n\n\n  //calculate surface reflectivity for fresnel schlick\n  vec3 f0 = vec3(0.04);\n  f0 = mix(f0, base_color.rgb, metallic);\n\n  //init radiance\n  vec3 Lo = vec3(0.0);\n  for(int i = 0; i < NUM_LIGHTS; ++i){\n\n    //calculate light vector\n    vec3 l = normalize(light_positions[i] - v_position);\n\n    //calculate halfway vector\n    vec3 h = normalize(l+v);\n\n    float distance    = length(light_positions[i] - v_position);\n    float attenuation = 1.0 / (distance * distance);\n    vec3 radiance     = light_colors[i] * attenuation;        \n    \n    // cook-torrance brdf\n    float NDF = DistributionGGX(n, h, roughness);        \n    float G   = GeometrySmith(n, v, l, roughness);      \n    vec3 F    = fresnelSchlickRoughness(max(dot(n, v), 0.0), f0, roughness);;       \n    \n      \n    \n    //calculate specular component\n    vec3 numerator    = NDF * G * F;\n    float denominator = 4.0 * max(dot(n, v), 0.0) * max(dot(n, l), 0.0) + 0.001;\n    vec3 specular     = numerator / denominator;  \n    \n    //calulate diffuse\n    vec3 kS = F;\n    vec3 kD = vec3(1.0) - kS;\n    kD *= 1.0 - metallic;\t\n\n    // integrate to outgoing radiance Lo\n    float NdotL = max(dot(n, l), 0.0);                \n    Lo += (kD * base_color.rgb / PI + specular) * radiance * NdotL;\n  }\n\n  vec3 F = fresnelSchlickRoughness(max(dot(n, v), 0.0), f0, roughness);\n\n  //diffuse ibl\n  vec3 kS = F;\n  vec3 kD = vec3(1.0) - kS;\n  kD *= 1.0 - metallic;\t  \n  vec3 irradiance = texture(diffuse_map, n).rgb;\n  vec3 diffuse    = irradiance * base_color.rgb;\n\n  //calculate speculare ibl\n  const float MAX_REFLECTION_LOD = 40.0;\n  vec3 prefilteredColor = texture(prefilter_map, R,  roughness).rgb;   \n  vec2 envBRDF  = texture(brdflut_map, vec2(max(dot(n, v), 0.0), roughness)).rg;\n  vec3 specular = prefilteredColor * (F * envBRDF.x + envBRDF.y);\n  vec3 ambient    = (kD * diffuse + (specular)) ; \n  \n  vec3 c = ambient + Lo;\n\n  #ifdef OCCLUSIONTEXTURE\n  c *= occlusion;\n  #endif\n\n  #ifdef EMISSIVETEXTURE\n  c+=emissive;\n  #endif\n\n  //c = c / (c + vec3(1.0));\n  c = pow(c, vec3(1.0/1.8));\n\n  //set color \n  color = vec4(c, 1);\n\n}\n";Math.clamp=function(e,t,n){return Math.min(Math.max(e,t),n)};class Yt{constructor(e,t,n,o){this.fovy=e,this.aspect=t,this.near=n,this.far=o,this.perspective_matrix=r.create(),r.perspective(this.perspective_matrix,this.fovy,this.aspect,this.near,this.far),this.eye=a.fromValues(0,0,1),this.target=a.fromValues(0,0,0),this.up=a.fromValues(0,1,0),this.view_matrix=r.create(),r.lookAt(this.view_matrix,this.eye,this.target,this.up)}set_perspective_uniform(e,t){e.uniformMatrix4fv(t,!1,this.perspective_matrix)}set_view_uniform(e,t){e.uniformMatrix4fv(t,!1,this.view_matrix)}set_orbit_controls(e,t,n){this.mousedown=!1,this.temp_mouse_x=0,this.temp_mouse_y=0,this.distance=7*Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),console.log(this.distance),r.perspective(this.perspective_matrix,this.fovy,this.aspect,this.near,10*this.distance),this.angle1=0,this.angle2=0,this.gain=10,this.eye=a.fromValues(this.distance,0,0),this.target=a.fromValues((t[0]+n[0])/2,(t[1]+n[1])/2,(t[2]+n[2])/2),r.lookAt(this.view_matrix,this.eye,this.target,this.up),e.canvas.addEventListener("mousedown",e=>{this.mousedown=!0,this.temp_mouse_x=e.clientX,this.temp_mouse_y=e.clientY,this.temp_angle_1=this.angle1,this.temp_angle_2=this.angle2}),e.canvas.addEventListener("mouseup",e=>{this.mousedown=!1}),e.canvas.addEventListener("mousemove",e=>{if(this.mousedown){var t=e.clientX,n=e.clientY,o=this.gain*(t-this.temp_mouse_x)/window.innerWidth,i=this.gain*(n-this.temp_mouse_y)/window.innerHeight;this.angle1=this.temp_angle_1+o,this.angle2=Math.clamp(-Math.PI/2,this.temp_angle_2+i,Math.PI/2);var s=this.distance*Math.cos(this.angle2),u=this.distance*Math.sin(this.angle2)+this.target[1],c=s*Math.cos(this.angle1)+this.target[0],l=s*Math.sin(this.angle1)+this.target[2];this.eye=a.fromValues(c,u,l),r.lookAt(this.view_matrix,this.eye,this.target,this.up)}}),e.canvas.addEventListener("wheel",e=>{e.preventDefault();var t=.1*a.dist(this.eye,this.target);e.deltaY<0&&(this.distance-=t),e.deltaY>0&&(this.distance+=t);var n=this.distance*Math.cos(this.angle2),o=this.distance*Math.sin(this.angle2)+this.target[1],i=n*Math.cos(this.angle1)+this.target[0],s=n*Math.sin(this.angle1)+this.target[2];this.eye=a.fromValues(i,o,s),r.lookAt(this.view_matrix,this.eye,this.target,this.up)}),e.canvas.addEventListener("contextmenu",e=>{e.preventDefault()})}}function Wt(e,t){return Ot="",Gt="",jt(t,"text").then(function(e){return Ot=e.responseURL,Gt=Ot.slice(0,Ot.lastIndexOf("/")+1),JSON.parse(e.responseText)}).then(function(t){return function(e,t,n){t._max=a.fromValues(0,0,0),t._min=a.fromValues(0,0,0),t._loads=[],t._renders=[],t._animations=[],null==n&&(n=0);var r=t.scenes[n].nodes;if(0==r.length)return!1;!function(e,t){var n=t._default_material={};n._is_defualt=!0,n._shader_program=nn(e,[],kt,Ht)}(e,t);for(var o=0;o<r.length;o++)en(e,t,r[o]);if(t.animations)for(var o=0;o<t.animations.length;o++)Qt(e,t,t.animations[o]);on(e,t),t._camera=new Yt(.2,e.canvas.width/e.canvas.height,.1,100),t._animate=t.animations&&t._animations?function(e){t._animations[0](e)}:()=>{};var i,s,u=Jt()/1e3;return t._render=function(){i=Jt()/1e3,s=u-i,t._animate(s),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.enable(e.DEPTH_TEST),t._renders.forEach(e=>{e()}),u=i,requestAnimationFrame(t._render)},Promise.all(t._loads).then(()=>(t._camera.set_orbit_controls(e,t._max,t._min),t))}(e,t)})}function jt(e,t){-1==e.search("data:")&&(e=Gt+e);var n=new XMLHttpRequest;return new Promise(function(r,a){n.onreadystatechange=()=>{if(4!==n.readyState)return!1;4==n.readyState&&200==n.status?r(n):a({status:n.status,statusText:n.statusText})},n.open("GET",e),t&&(n.responseType=t),n.send()})}function Jt(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}function Kt(e,t,n,r,a,o){var i=t.accessors[n],s=t.bufferViews[i.bufferView],u=t.buffers[s.buffer];u._onload||(u._onload=jt(u.uri,"arraybuffer"),t._loads.push(u._onload)),u._onload.then(e=>{var t=s.byteOffset,n=s.byteLength;i.byteOffset&&(t+=i.byteOffset,n-=i.byteOffset),console.log(n);var u=new Float32Array(e.response,t,i.count*Bt[i.type]);console.log(u),a?(r._inputs=u,r._max_input=-1e5,r._min_input=1e5,r._inputs.forEach(e=>{e>r._max_input&&(r._max_input=e),e<r._min_input&&(r._min_input=e)}),r._min_input<o._min_time&&(o._min_time=r._min_input),r._max_input>o._max_time&&(o._max_time=r._max_input)):r._outputs=u})}function Zt(e,t,n,r){console.log("processing sampler"),Kt(0,t,n.input,n,!0,r),Kt(0,t,n.output,n,!1,r)}function Qt(e,t,n){if(n.name=n.name?n.name:"unnamed_anim",n._min_time=1e5,n._max_time=-1e5,n.samplers)for(var r=0;r<n.samplers.length;r++)Zt(0,t,n.samplers[r],n);var a=0;n._animate=function(e){(a+=Math.abs(e))>n._max_time&&(a=n._min_time),n.channels.forEach(e=>{var r=t.nodes[e.target.node],o=(r[e.target.path],n.samplers[e.sampler]);if(!(a<o._min_input||a>o._max_input)){var i=1e5,s=1e5,u=0,c=0,l=[void 0,void 0];o._inputs&&o._inputs.forEach((e,t)=>{var n=a-e;n>0?Math.abs(n)<i&&(u=e,l[0]=t,i=Math.abs(n)):Math.abs(n)<s&&(c=e,l[1]=t,s=Math.abs(n))});for(var f,m=(a-u)/(c-u),h=[],d=[],_=[],p=0;p<Ct[e.target.path];p++)d.push(o._outputs[l[0]*Ct[e.target.path]+p]),_.push(o._outputs[l[1]*Ct[e.target.path]+p]),f=_[p]-d[p],h.push(d[p]+m*f);r[e.target.path]=h,console.log(e.target.path+":"+h),function e(t,n,r){if($t(n,r),n.children)for(var a=0;a<n.children.length;a++)e(t,t.nodes[n.children[a]],n)}(t,r)}})},t._animations.push(n._animate)}function $t(e,t){var n=r.create();if(r.identity(n),e.matrix)n=r.clone(e.matrix);else{e.translation||(e.translation=a.fromValues(0,0,0)),e.rotation||(e.rotation=o.create(),o.identity(e.rotation)),e.scale||(e.scale=a.create(),e.scale=a.fromValues(1,1,1));var i=o.create();o.normalize(i,o.fromValues(...e.rotation)),r.fromRotationTranslation(n,i,e.translation),r.scale(n,n,e.scale)}e._model=null!=t?r.multiply(r.create(),t._model,n):n}function en(e,t,n,a){var o=t.nodes[n];if($t(o,null!=a?t.nodes[a]:void 0),o.skin>=0&&function(e,t,n,a){var o=t.skins[n];o.inverseBindMatrices>=0&&function(e,t,n,a){var o=t.accessors[n],i=t.bufferViews[o.bufferView],s=t.buffers[i.buffer];s._onload||(s._onload=jt(s.uri,"arraybuffer"),t._loads.push(s._onload));a._inverseBindMatrices=[],a._globalJointTransforms=[],a._jointMatrices=[],s._onload.then(e=>{var n=i.byteOffset;i.byteLength;o.byteOffset&&(n+=o.byteOffset,o.byteOffset);var s=new Float32Array(e.response,n,o.count*Bt[o.type]);for(let e=0;e<s.length;e+=16){var u=a.joints[e],c=t.nodes[u];c._inverseBindMatrix=array.slice(e,e+16),c._globalJointTransform=c._model,c._jointMatrix=new Float32Array(16),a._inverseBindMatrices.push(c._inverseBindMatrix),a._globalJointTransforms.push(c._globalJointTransform),a._jointMatrices.push(c._jointMatrix),c._updateJointBindPose=function(){r.multiply(c._jointMatrix,c._globalJointTransform,c._inverseBindMatrix)},c._updateJointBindPose()}})}(0,t,o.inverseBindMatrices,o)}(0,t,o.skin),o.mesh>=0&&function(e,t,n,r){var a=t.meshes[n];if(a.primitives)for(var o=0;o<a.primitives.length;o++){var i,s,u=a.primitives[o];if(u._vao=e.createVertexArray(),e.bindVertexArray(u._vao),u.attributes)for(const n in u.attributes)tn(e,t,u.attributes[n],n,u._vao);u.indices>=0?(tn(e,t,u.indices,void 0,u._vao),i=t.accessors[u.indices]):console.log("This mesh does not have an index buffer"),e.bindVertexArray(null),u.material>=0?(rn(e,t,u.material),s=t.materials[u.material]):s=t._default_material,u._render=function(){e.bindVertexArray(u._vao),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i._buffer),e.useProgram(s._shader_program);var n=e.getUniformLocation(s._shader_program,"perspective"),a=e.getUniformLocation(s._shader_program,"view");e.uniformMatrix4fv(n,e.FALSE,t._camera.perspective_matrix),e.uniformMatrix4fv(a,e.FALSE,t._camera.view_matrix);var o=e.getUniformLocation(s._shader_program,"model");e.uniformMatrix4fv(o,e.FALSE,r._model);var c=0;if(!s._is_defualt){s._textures.forEach(n=>{var r=s._uniform_locs[n.name],a=t.textures[n.index];e.activeTexture(e.TEXTURE0+c),e.bindTexture(e.TEXTURE_2D,a._buffer),e.uniform1i(r,c),c++});var l=e.getUniformLocation(s._shader_program,"diffuse_map"),f=e.getUniformLocation(s._shader_program,"prefilter_map"),m=e.getUniformLocation(s._shader_program,"brdflut_map");t._environment.set_diffuse_uniform(e,c,l),t._environment.set_prefilter_uniform(e,++c,f),t._environment.set_brdflut_uniform(e,++c,m)}e.drawElements(e.TRIANGLES,i.count,i.componentType,0)},t._renders.push(u._render)}}(e,t,o.mesh,o),o.children)for(var i=0;i<o.children.length;i++)en(e,t,o.children[i],o)}function tn(e,t,n,r,a){var o=t.accessors[n];o._buffer=e.createBuffer();var i=t.bufferViews[o.bufferView],s=t.buffers[i.buffer];s._onload||(s._onload=jt(s.uri,"arraybuffer"),t._loads.push(s._onload)),s._onload.then(n=>{var s=i.byteOffset,u=i.byteLength;if(o.byteOffset&&(s+=o.byteOffset,u-=o.byteOffset),e.bindVertexArray(a),null!=r){var c=new Float32Array(n.response,s,u/Float32Array.BYTES_PER_ELEMENT);e.bindBuffer(e.ARRAY_BUFFER,o._buffer),e.bufferData(e.ARRAY_BUFFER,c,e.STATIC_DRAW),e.enableVertexAttribArray(Xt[r]),e.vertexAttribPointer(Xt[r],Bt[o.type],o.componentType,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,null),"POSITION"==r&&(t._min[0]=t._min[0]>o.min[0]?o.min[0]:t._min[0],t._min[1]=t._min[1]>o.min[1]?o.min[1]:t._min[1],t._min[2]=t._min[2]>o.min[2]?o.min[2]:t._min[2],t._max[0]=t._max[0]<o.max[0]?o.max[0]:t._max[0],t._max[1]=t._max[1]<o.max[1]?o.max[1]:t._max[1],t._max[2]=t._max[2]<o.max[2]?o.max[2]:t._max[2])}else{c=new Uint16Array(n.response,s,u/Uint16Array.BYTES_PER_ELEMENT);o._buffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o._buffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,c,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}})}function nn(e,t,n,r){var a="#version 300 es \n";if(null!=t)for(var o=0;o<t.length;o++){a+="#define "+t[o].toUpperCase()+"\n"}var i=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(i,a+n),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))return e.deleteShader(i),!1;var s=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(s,a+r),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))return console.log(e.getShaderInfoLog(s)),e.deleteShader(s),!1;var u=e.createProgram();return e.attachShader(u,i),e.attachShader(u,s),e.linkProgram(u),e.getProgramParameter(u,e.LINK_STATUS)?u:(console.log(e.getProgramInfoLog(u)),e.deleteProgram(u),!1)}function rn(e,t,n){var r=t.materials[n];r._shader_params=[],r._textures=[];for(const n in r)if("_shader_params"!=n&&"name"!=n&&"_textures"!=n&&"_uniform_locs"!=n)if(n.includes("Texture"))r._shader_params.push(n),r._textures.push({index:r[n].index,name:n}),an(e,t,r[n].index);else if(n.includes("Factor"))r._shader_params.push(n);else{var a=r[n];for(const n in a)console.log(n),n.includes("Texture")?(r._shader_params.push(n),r._textures.push({index:a[n].index,name:n}),an(e,t,a[n].index)):n.includes("Factor")&&r._shader_params.push(n)}r._shader_program=nn(e,r._shader_params,zt,qt),r._uniform_locs={},r._shader_params.forEach(t=>{r._uniform_locs[t]=e.getUniformLocation(r._shader_program,t)})}function an(e,t,n){var r=t.textures[n];r._buffer=e.createTexture();var a,o=t.images[r.source],i=r.sampler||t.samplers?t.samplers[r.sampler]:void 0;o._onload||(o._onload=(a=o.uri,-1==a.search("data:")&&(a=Gt+a),new Promise((e,t)=>{let n=new Image;n.onload=function(){e(n)},n.onerror=function(){t(new Error(`Failed to load image's URL: ${a}`))},n.src=a})).then(t=>(e.bindTexture(e.TEXTURE_2D,r._buffer),i?(i.wrapS&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,i.wrapS),i.wrapT&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,i.wrapT),i.minFilter&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i.minFilter),i.magFilter&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i.magFilter)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null),o.uri)),t._loads.push(o._onload))}function on(e,t){const n=new Float32Array([-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1]),o=e.createVertexArray(),i=e.createBuffer();e.bindVertexArray(o),e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW),e.enableVertexAttribArray(Xt.POSITION),e.vertexAttribPointer(Xt.POSITION,3,e.FLOAT,e.FALSE,0,0),e.bindVertexArray(null);var s=e.createShader(e.VERTEX_SHADER);e.shaderSource(s,"#version 300 es\n    layout( location = 0 ) in vec3 position;\n\n    uniform mat4 perspective;\n    uniform mat4 view;\n\n    out vec3 v_normal;\n\n    \n    void main(){\n        vec4 pos = perspective*view*vec4(position*vec3(100), 1.0);\n        gl_Position = pos.xyzw;\n        v_normal = position;\n    }\n    "),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS)||(console.log(e.getShaderInfoLog(s)),e.deleteShader(s));var u=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(u,"#version 300 es\n    precision mediump float;\n \n    in vec3 v_normal;\n    out vec4 color;\n     \n    uniform samplerCube env_map;\n    uniform samplerCube diffuse_map;\n    uniform samplerCube prefilter_map;\n    uniform sampler2D brdflut_map;\n     \n    void main() {\n       color = texture(env_map, v_normal);\n    }\n    "),e.compileShader(u),e.getShaderParameter(u,e.COMPILE_STATUS)||(console.log(e.getShaderInfoLog(u)),e.deleteShader(u));var c=e.createProgram();e.attachShader(c,s),e.attachShader(c,u),e.linkProgram(c),e.getProgramParameter(c,e.LINK_STATUS)||(console.log(e.getProgramInfoLog(c)),e.deleteProgram(c));var f=e.createTexture();e.bindTexture(e.TEXTURE_CUBE_MAP,f),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_MODE,e.NONE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_FUNC,e.LEQUAL);const m=[{target:e.TEXTURE_CUBE_MAP_POSITIVE_X,src:"assets/env_map/px.hdr"},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_X,src:"assets/env_map/nx.hdr"},{target:e.TEXTURE_CUBE_MAP_POSITIVE_Y,src:"assets/env_map/py.hdr"},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_Y,src:"assets/env_map/ny.hdr"},{target:e.TEXTURE_CUBE_MAP_POSITIVE_Z,src:"assets/env_map/pz.hdr"},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_Z,src:"assets/env_map/nz.hdr"}];var h=[],d={onload:null,vao:o,vert_buffer:i,texture:f,diffuse:void 0,program:c,texture_loc:e.getUniformLocation(c,Dt.env_map),diffuse_loc:e.getUniformLocation(c,Dt.diffuse_map),prefilter_loc:e.getUniformLocation(c,"prefilter_map"),brdflut_loc:e.getUniformLocation(c,"brdflut_map"),perspective_loc:e.getUniformLocation(c,Dt.perspective),view_loc:e.getUniformLocation(c,Dt.view),render:function(e,t){e.bindVertexArray(this.vao),e.useProgram(this.program),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this.texture),e.uniform1i(this.texture_loc,0),t.set_perspective_uniform(e,this.perspective_loc),t.set_view_uniform(e,this.view_loc),e.drawArrays(e.TRIANGLES,0,36),e.bindVertexArray(null)},set_texture_uniform:function(e,t,n){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_CUBE_MAP,this.texture),e.uniform1i(n,t)},set_diffuse_uniform:function(e,t,n){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_CUBE_MAP,this.diffuse),e.uniform1i(n,t)},set_prefilter_uniform:function(e,t,n){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_CUBE_MAP,this.prefilter),e.uniform1i(n,t)},set_brdflut_uniform:function(e,t,n){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.brdflut),e.uniform1i(n,t)}},_=new Promise(t=>{m.forEach(n=>{const{target:i,src:s}=n;var u=new Vt;u.onload=function(){if(h.push({image:u,target:i}),h.length>=m.length){e.bindTexture(e.TEXTURE_CUBE_MAP,f),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_MODE,e.NONE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_FUNC,e.LEQUAL);for(var n=0;n<h.length;n++)e.texImage2D(h[n].target,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,h[n].image);e.generateMipmap(e.TEXTURE_CUBE_MAP),e.bindTexture(e.TEXTURE_CUBE_MAP,null),d.diffuse=function(e,t,n){var o="#version 300 es\n    layout( location = "+Xt.POSITION+" ) in vec3 position;\n\n    uniform mat4 perspective;\n    uniform mat4 view;\n\n    out vec3 v_normal;\n\n    \n    void main(){\n        vec4 pos = perspective*view*vec4(position, 1.0);\n        gl_Position = pos.xyzw;\n        v_normal = position;\n    }",i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,o),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||(console.log(e.getShaderInfoLog(i)),e.deleteShader(i));var s=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(s,"#version 300 es\n    precision mediump float;\n \n    in vec3 v_normal;\n    out vec4 color;\n    \n    const float PI = 3.14159265359;\n     \n    uniform samplerCube env_map;\n     \n    void main() {\n        vec3 normal = normalize(v_normal);\n\n        vec3 irradiance = vec3(0.0);\n\n        vec3 up    = vec3(0.0, 1.0, 0.0);\n        vec3 right = cross(up, normal);\n        up         = cross(normal, right);\n\n        float sampleDelta = 0.025;\n        float nrSamples = 0.0; \n        for(float phi = 0.0; phi < 2.0 * PI; phi += sampleDelta)\n        {\n            for(float theta = 0.0; theta < 0.5 * PI; theta += sampleDelta)\n            {\n                // spherical to cartesian (in tangent space)\n                vec3 tangentSample = vec3(sin(theta) * cos(phi),  sin(theta) * sin(phi), cos(theta));\n                // tangent space to world\n                vec3 sampleVec = tangentSample.x * right + tangentSample.y * up + tangentSample.z * normal; \n\n                irradiance += texture(env_map, sampleVec).rgb * cos(theta) * sin(theta);\n                nrSamples++;\n            }\n        }\n        irradiance = PI * irradiance * (1.0 / float(nrSamples));\n        \n        color = vec4(irradiance, 1.0);\n    }\n    "),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS)||(console.log(e.getShaderInfoLog(s)),e.deleteShader(s));var u=e.createProgram();e.attachShader(u,i),e.attachShader(u,s),e.linkProgram(u),e.getProgramParameter(u,e.LINK_STATUS)||(console.log(e.getProgramInfoLog(u)),e.deleteProgram(u));var c=e.getUniformLocation(u,Dt.env_map),f=e.getUniformLocation(u,Dt.perspective),m=e.getUniformLocation(u,Dt.view),h=e.createTexture();e.bindTexture(e.TEXTURE_CUBE_MAP,h);for(var d=0;d<6;d++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([255,0,0,255,0,255,0,255,0,0,255,255]));e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR);var _=e.createFramebuffer();e.createRenderbuffer();e.bindFramebuffer(e.FRAMEBUFFER,_),e.bindFramebuffer(e.FRAMEBUFFER,null);var p=r.perspective(r.create(),l(90),1,.1,10),E=[r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(1,0,0),a.fromValues(0,-1,0)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(-1,0,0),a.fromValues(0,-1,0)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(0,1,0),a.fromValues(0,0,1)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(0,-1,0),a.fromValues(0,0,-1)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(0,0,1),a.fromValues(0,-1,0)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(0,0,-1),a.fromValues(0,-1,0))];e.bindVertexArray(n),e.useProgram(u),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,t),e.uniform1i(c,0),e.uniformMatrix4fv(f,e.FALSE,p),e.viewport(0,0,32,32);for(var d=0;d<6;d++)e.bindFramebuffer(e.FRAMEBUFFER,_),e.uniformMatrix4fv(m,e.FALSE,E[d]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+d,h,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.drawArrays(e.TRIANGLES,0,36);return e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteFramebuffer(_),h}(e,f,o),d.prefilter=function(e,t,n){var o=e.createTexture();e.bindTexture(e.TEXTURE_CUBE_MAP,o);for(var i=0;i<6;i++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,e.RGBA,128,128,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.generateMipmap(e.TEXTURE_CUBE_MAP);var s="#version 300 es\n    layout( location = "+Xt.POSITION+" ) in vec3 position;\n\n    uniform mat4 perspective;\n    uniform mat4 view;\n\n    out vec3 v_normal;\n    \n    void main(){\n        vec4 pos = perspective*view*vec4(position, 1.0);\n        gl_Position = pos.xyzw;\n        v_normal = position;\n    }",u=e.createShader(e.VERTEX_SHADER);e.shaderSource(u,s),e.compileShader(u),e.getShaderParameter(u,e.COMPILE_STATUS)||(console.log(e.getShaderInfoLog(u)),e.deleteShader(u));var c=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(c,"#version 300 es\n    precision mediump float;\n    \n    const float PI = 3.14159265359;\n\n    in vec3 v_normal;\n    out vec4 color;\n\n    float VanDerCorpus(uint n, uint base)\n    {\n        float invBase = 1.0 / float(base);\n        float denom   = 1.0;\n        float result  = 0.0;\n\n        for(uint i = 0u; i < 32u; ++i)\n        {\n            if(n > 0u)\n            {\n                denom   = mod(float(n), 2.0);\n                result += denom * invBase;\n                invBase = invBase / 2.0;\n                n       = uint(float(n) / 2.0);\n            }\n        }\n\n        return result;\n    }\n    vec2 Hammersley(uint i, uint N)\n    {\n        return vec2(float(i)/float(N), VanDerCorpus(i, 2u));\n    }\n\n    vec3 ImportanceSampleGGX(vec2 Xi, vec3 N, float roughness)\n    {\n        float a = roughness*roughness;\n        \n        float phi = 2.0 * PI * Xi.x;\n        float cosTheta = sqrt((1.0 - Xi.y) / (1.0 + (a*a - 1.0) * Xi.y));\n        float sinTheta = sqrt(1.0 - cosTheta*cosTheta);\n        \n        // from spherical coordinates to cartesian coordinates\n        vec3 H;\n        H.x = cos(phi) * sinTheta;\n        H.y = sin(phi) * sinTheta;\n        H.z = cosTheta;\n        \n        // from tangent-space vector to world-space sample vector\n        vec3 up        = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n        vec3 tangent   = normalize(cross(up, N));\n        vec3 bitangent = cross(N, tangent);\n        \n        vec3 sampleVec = tangent * H.x + bitangent * H.y + N * H.z;\n        return normalize(sampleVec);\n    }  \n\n     \n    uniform samplerCube env_map;\n    uniform float roughness;  \n\n    void main() {        \n        vec3 N = normalize(v_normal);    \n        vec3 R = N;\n        vec3 V = R;\n\n        const uint SAMPLE_COUNT = 1024u;\n        float totalWeight = 0.0;   \n        vec3 prefilteredColor = vec3(0.0);     \n        for(uint i = 0u; i < SAMPLE_COUNT; ++i)\n        {\n            vec2 Xi = Hammersley(i, SAMPLE_COUNT);\n            vec3 H  = ImportanceSampleGGX(Xi, N, roughness);\n            vec3 L  = normalize(2.0 * dot(V, H) * H - V);\n\n            float NdotL = max(dot(N, L), 0.0);\n            if(NdotL > 0.0)\n            {\n                prefilteredColor += texture(env_map, L).rgb * NdotL;\n                totalWeight      += NdotL;\n            }\n        }\n        prefilteredColor = prefilteredColor / totalWeight;\n\n        color = vec4(prefilteredColor, 1.0);\n    }\n    "),e.compileShader(c),e.getShaderParameter(c,e.COMPILE_STATUS)||(console.log(e.getShaderInfoLog(c)),e.deleteShader(c));var f=e.createProgram();e.attachShader(f,u),e.attachShader(f,c),e.linkProgram(f),e.getProgramParameter(f,e.LINK_STATUS)||(console.log(e.getProgramInfoLog(f)),e.deleteProgram(f));var m=e.getUniformLocation(f,Dt.env_map),h=e.getUniformLocation(f,"roughness"),d=e.getUniformLocation(f,Dt.perspective),_=e.getUniformLocation(f,Dt.view),p=[r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(1,0,0),a.fromValues(0,-1,0)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(-1,0,0),a.fromValues(0,-1,0)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(0,1,0),a.fromValues(0,0,1)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(0,-1,0),a.fromValues(0,0,-1)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(0,0,1),a.fromValues(0,-1,0)),r.lookAt(r.create(),a.fromValues(0,0,0),a.fromValues(0,0,-1),a.fromValues(0,-1,0))],E=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,E),e.bindVertexArray(n),e.useProgram(f),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,t),e.uniform1i(m,0),e.uniformMatrix4fv(d,e.FALSE,r.perspective(r.create(),l(90),1,.1,10)),e.bindFramebuffer(e.FRAMEBUFFER,E);for(var v=0;v<10;++v){var T=128*Math.pow(.5,v),g=128*Math.pow(.5,v);e.viewport(0,0,T,g);var M=v/9;e.uniform1f(h,M);for(var i=0;i<6;++i)e.uniformMatrix4fv(_,e.FALSE,p[i]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+i,o,v),e.clear(e.COLOR_BUFFER_BIT,e.DEPTH_BUFFER_BIT),e.drawArrays(e.TRIANGLES,0,36)}return e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteFramebuffer(E),o}(e,f,o),d.brdflut=function(e,t){const n=e.createVertexArray();var r="#version 300 es\n    layout( location = "+Xt.POSITION+" ) in vec3 position;\n\n    out vec2 v_position;\n    \n    void main(){\n        float x = float(((uint(gl_VertexID) + 2u) / 3u)%2u); \n        float y = float(((uint(gl_VertexID) + 1u) / 3u)%2u); \n\n        gl_Position = vec4(-1.0f + x*2.0f, -1.0f+y*2.0f, 0.0f, 1.0f);\n        v_position = vec2(x, y);\n    }",a=e.createShader(e.VERTEX_SHADER);e.shaderSource(a,r),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)||(console.log(e.getShaderInfoLog(a)),e.deleteShader(a));var o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(o,"#version 300 es\n    precision mediump float;\n\n    in vec2 v_position;\n    out vec4 color;\n\n    const float PI = 3.14159265359;\n\n\n    float VanDerCorpus(uint n, uint base)\n    {\n        float invBase = 1.0 / float(base);\n        float denom   = 1.0;\n        float result  = 0.0;\n\n        for(uint i = 0u; i < 32u; ++i)\n        {\n            if(n > 0u)\n            {\n                denom   = mod(float(n), 2.0);\n                result += denom * invBase;\n                invBase = invBase / 2.0;\n                n       = uint(float(n) / 2.0);\n            }\n        }\n\n        return result;\n    }\n    vec2 Hammersley(uint i, uint N)\n    {\n        return vec2(float(i)/float(N), VanDerCorpus(i, 2u));\n    }\n\n    vec3 ImportanceSampleGGX(vec2 Xi, vec3 N, float roughness)\n    {\n        float a = roughness*roughness;\n        \n        float phi = 2.0 * PI * Xi.x;\n        float cosTheta = sqrt((1.0 - Xi.y) / (1.0 + (a*a - 1.0) * Xi.y));\n        float sinTheta = sqrt(1.0 - cosTheta*cosTheta);\n        \n        // from spherical coordinates to cartesian coordinates\n        vec3 H;\n        H.x = cos(phi) * sinTheta;\n        H.y = sin(phi) * sinTheta;\n        H.z = cosTheta;\n        \n        // from tangent-space vector to world-space sample vector\n        vec3 up        = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n        vec3 tangent   = normalize(cross(up, N));\n        vec3 bitangent = cross(N, tangent);\n        \n        vec3 sampleVec = tangent * H.x + bitangent * H.y + N * H.z;\n        return normalize(sampleVec);\n    }  \n\n    float GeometrySchlickGGX(float NdotV, float roughness)\n{\n    float a = roughness;\n    float k = (a * a) / 2.0;\n\n    float nom   = NdotV;\n    float denom = NdotV * (1.0 - k) + k;\n\n    return nom / denom;\n}\n// ----------------------------------------------------------------------------\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness)\n{\n    float NdotV = max(dot(N, V), 0.0);\n    float NdotL = max(dot(N, L), 0.0);\n    float ggx2 = GeometrySchlickGGX(NdotV, roughness);\n    float ggx1 = GeometrySchlickGGX(NdotL, roughness);\n\n    return ggx1 * ggx2;\n} \n    vec2 IntegrateBRDF(float NdotV, float roughness)\n{\n    vec3 V;\n    V.x = sqrt(1.0 - NdotV*NdotV);\n    V.y = 0.0;\n    V.z = NdotV;\n\n    float A = 0.0;\n    float B = 0.0;\n\n    vec3 N = vec3(0.0, 0.0, 1.0);\n\n    const uint SAMPLE_COUNT = 1024u;\n    for(uint i = 0u; i < SAMPLE_COUNT; ++i)\n    {\n        vec2 Xi = Hammersley(i, SAMPLE_COUNT);\n        vec3 H  = ImportanceSampleGGX(Xi, N, roughness);\n        vec3 L  = normalize(2.0 * dot(V, H) * H - V);\n\n        float NdotL = max(L.z, 0.0);\n        float NdotH = max(H.z, 0.0);\n        float VdotH = max(dot(V, H), 0.0);\n\n        if(NdotL > 0.0)\n        {\n            float G = GeometrySmith(N, V, L, roughness);\n            float G_Vis = (G * VdotH) / (NdotH * NdotV);\n            float Fc = pow(1.0 - VdotH, 5.0);\n\n            A += (1.0 - Fc) * G_Vis;\n            B += Fc * G_Vis;\n        }\n    }\n    A /= float(SAMPLE_COUNT);\n    B /= float(SAMPLE_COUNT);\n    return vec2(A, B);\n}\n// ----------------------------------------------------------------------------\nvoid main() \n{\n    vec2 integratedBRDF = IntegrateBRDF(v_position.x, v_position.y);\n    color = vec4(integratedBRDF, 0.0, 1.0);\n}"),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)||(console.log(e.getShaderInfoLog(o)),e.deleteShader(o));var i=e.createProgram();e.attachShader(i,a),e.attachShader(i,o),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)||(console.log(e.getProgramInfoLog(i)),e.deleteProgram(i));var s=e.createFramebuffer();e.createRenderbuffer();e.bindFramebuffer(e.FRAMEBUFFER,s);var u=e.createTexture();return e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGB,512,512,0,e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.bindTexture(e.TEXTURE_2D,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,u,0),e.bindFramebuffer(e.FRAMEBUFFER,s),e.viewport(0,0,512,512),e.bindVertexArray(n),e.useProgram(i),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.drawArrays(e.TRIANGLES,0,6),e.bindVertexArray(null),e.bindFramebuffer(e.FRAMEBUFFER,null),u}(e),t(h)}},u.src=s})});d.onload=_,t._loads.push(d.onload),t._environment=d}document.body.innerHTML+="\n<style>\n@-webkit-keyframes spin {\n    to {\n      -webkit-transform: rotate(360deg);\n              transform: rotate(360deg);\n    }\n  }\n  @keyframes spin {\n    to {\n      -webkit-transform: rotate(360deg);\n              transform: rotate(360deg);\n    }\n  }\n  .stroke-dotted {\n    opacity: 0;\n    stroke-dasharray: 4,5;\n    stroke-width: 1px;\n    -webkit-transform-origin: 50% 50%;\n            transform-origin: 50% 50%;\n    -webkit-animation: spin 4s infinite linear;\n            animation: spin 4s infinite linear;\n    -webkit-transition: opacity 1s ease,  stroke-width 1s ease;\n    transition: opacity 1s ease,  stroke-width 1s ease;\n  }\n  \n  .stroke-solid {\n    stroke-dashoffset: 0;\n    stroke-dashArray: 300;\n    stroke-width: 4px;\n    -webkit-transition: stroke-dashoffset 1s ease,  opacity 1s ease;\n    transition: stroke-dashoffset 1s ease,  opacity 1s ease;\n  }\n  \n  .icon {\n    -webkit-transform-origin: 50% 50%;\n            transform-origin: 50% 50%;\n    -webkit-transition: -webkit-transform 200ms ease-out;\n    transition: -webkit-transform 200ms ease-out;\n    transition: transform 200ms ease-out;\n    transition: transform 200ms ease-out, -webkit-transform 200ms ease-out;\n  }\n  \n  #play:hover .stroke-dotted {\n    stroke-width: 4px;\n    opacity: 1;\n  }\n  #play:hover .stroke-solid {\n    opacity: 0;\n    stroke-dashoffset: 300;\n  }\n  #play:hover .icon {\n    -webkit-transform: scale(1.05);\n            transform: scale(1.05);\n  }\n  \n  #play {\n    cursor: pointer;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    -webkit-transform: translateY(-50%) translateX(-50%);\n            transform: translateY(-50%) translateX(-50%);\n  }\n  \n</style>\n";window.customElements.define("poly-wolf",class extends HTMLDivElement{constructor(){super(),this.style="\n            position:relative;\n            background-color:white;\n            padding:0;\n            margin:0;\n            border-width:0.5px;\n            border-radius:10px;\n            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);\n            background-color: #30FF98;\n            background: radial-gradient(#71edb5, #30ff98);\n        ",this.canvas=document.createElement("canvas"),this.appendChild(this.canvas),this.canvas.height=this.getAttribute("height"),this.canvas.width=this.getAttribute("width"),this.style.height=this.canvas.height,this.style.width=this.canvas.width,this.canvas.style="\n            position:absolute;\n            opacity:0.9;\n        ",this.gl=this.canvas.getContext("webgl2"),this.url=this.getAttribute("url"),this.button=document.createElement("div"),this.button.innerHTML='\n        <svg version="1.1" id="play" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" height="50px" width="50px"\n\t viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve">\n  <path class="stroke-solid" fill="none" stroke="white"  d="M49.9,2.5C23.6,2.8,2.1,24.4,2.5,50.4C2.9,76.5,24.7,98,50.3,97.5c26.4-0.6,47.4-21.8,47.2-47.7\n    C97.3,23.7,75.7,2.3,49.9,2.5"/>\n  <path class="stroke-dotted" fill="none" stroke="white"  d="M49.9,2.5C23.6,2.8,2.1,24.4,2.5,50.4C2.9,76.5,24.7,98,50.3,97.5c26.4-0.6,47.4-21.8,47.2-47.7\n    C97.3,23.7,75.7,2.3,49.9,2.5"/>\n  <path class="icon" fill="white" d="M38,69c-1,0.5-1.8,0-1.8-1.1V32.1c0-1.1,0.8-1.6,1.8-1.1l34,18c1,0.5,1,1.4,0,1.9L38,69z"/>\n</svg>\n        ',this.button.style="\n            margin: 0;\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            border-radius:20px;\n        ",this.appendChild(this.button),this.button.onclick=()=>{this.button.innerHTML='\n            <svg version="1.1" id="play" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" height="50px" width="50px"\n                viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve">\n            <path class="stroke-dotted" fill="none" stroke="white"  d="M49.9,2.5C23.6,2.8,2.1,24.4,2.5,50.4C2.9,76.5,24.7,98,50.3,97.5c26.4-0.6,47.4-21.8,47.2-47.7\n                C97.3,23.7,75.7,2.3,49.9,2.5"/>\n            </svg>\n            ',this.load()}}load(){Wt(this.gl,this.url).then(e=>{this.button.style.visibility="hidden",console.log(e),e._render()})}},{extends:"div"}),window.customElements.whenDefined("poly-wolf").then(()=>{console.log("poly wolf has been defined")})}]);